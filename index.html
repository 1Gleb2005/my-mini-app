<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CONTROL CENTER</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: #000000;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 8px;
        }

        .game-container {
            width: 100%;
            max-width: 380px;
            background: #000000;
            border-radius: 24px;
            padding: 16px;
            border: 2px solid #8a2be2;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.3);
        }

        /* CONTROL CENTER –∑–∞–≥–æ–ª–æ–≤–æ–∫ */
        .control-center-header {
            color: #8a2be2;
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px #8a2be2;
            border-bottom: 1px solid #8a2be2;
            padding-bottom: 10px;
        }

        /* –ß–µ—Ç—ã—Ä–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é */
        .menu-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .menu-btn {
            flex: 1;
            min-width: 70px;
            background: #000000;
            border: 2px solid #8a2be2;
            border-radius: 30px;
            padding: 12px 0;
            color: #8a2be2;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .menu-btn.active {
            background: #8a2be2;
            color: white;
            border-color: #8a2be2;
            box-shadow: 0 0 15px #8a2be2;
        }

        .menu-btn:active {
            transform: scale(0.96);
        }

        /* –ë–∞–ª–∞–Ω—Å */
        .balance-row {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 20px;
            background: #000000;
            border: 1px solid #8a2be2;
            border-radius: 50px;
            padding: 12px 16px;
        }

        .balance-item {
            padding: 5px 15px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 700;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(138, 43, 226, 0.1);
            border: 1px solid #8a2be2;
        }

        .currency-icon {
            font-size: 20px;
            color: #8a2be2;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–∞–∑–¥–µ–ª–æ–≤ */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* –ò–≥—Ä–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å */
        .game-area {
            background: #000000;
            border-radius: 20px;
            padding: 12px;
            margin-bottom: 12px;
            border: 2px solid #8a2be2;
            aspect-ratio: 1/1;
            position: relative;
            box-shadow: inset 0 0 20px rgba(138, 43, 226, 0.2);
        }

        #gameCanvas {
            width: 100%;
            height: 100%;
            display: block;
            border-radius: 12px;
            background: #000000;
        }

        .multiplier {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 42px;
            font-weight: 800;
            color: #ffffff;
            text-shadow: 0 0 20px #8a2be2;
            z-index: 10;
            background: rgba(0,0,0,0.7);
            padding: 8px 24px;
            border-radius: 40px;
            backdrop-filter: blur(4px);
            border: 1px solid #8a2be2;
        }

        /* –ò—Å—Ç–æ—Ä–∏—è */
        .history-container {
            background: #000000;
            border-radius: 16px;
            padding: 12px;
            margin-bottom: 16px;
            border: 1px solid #8a2be2;
        }

        .history-label {
            color: #8a2be2;
            font-size: 12px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        #history {
            display: flex;
            flex-direction: column;
            gap: 4px;
            max-height: 100px;
            overflow-y: auto;
            padding: 4px;
            scrollbar-width: thin;
            scrollbar-color: #8a2be2 #000000;
        }

        #history::-webkit-scrollbar {
            width: 3px;
        }

        #history::-webkit-scrollbar-thumb {
            background: #8a2be2;
            border-radius: 3px;
        }

        .hist-item {
            background: #000000;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            border: 1px solid #8a2be2;
            color: #8a2be2;
            display: flex;
            justify-content: space-between;
        }

        /* –°—Ç–∞–≤–∫–∞ */
        .bet-section {
            background: #000000;
            border-radius: 20px;
            padding: 16px;
            border: 1px solid #8a2be2;
        }

        .bet-input-row {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        #bet-input {
            flex: 1;
            background: #000000;
            border: 1px solid #8a2be2;
            border-radius: 30px;
            padding: 14px 16px;
            color: white;
            font-size: 18px;
            font-weight: 600;
            outline: none;
        }

        #bet-input:focus {
            border-color: #9b4dff;
            box-shadow: 0 0 10px #8a2be2;
        }

        .currency-selector {
            display: flex;
            background: #000000;
            border-radius: 30px;
            padding: 4px;
            border: 1px solid #8a2be2;
            margin-bottom: 12px;
        }

        .curr-btn {
            flex: 1;
            background: none;
            border: none;
            color: #8a2be2;
            font-weight: 600;
            font-size: 14px;
            padding: 8px 0;
            border-radius: 30px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .curr-btn.active {
            background: #8a2be2;
            color: white;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .btn {
            flex: 1;
            border: none;
            border-radius: 40px;
            padding: 16px;
            font-size: 18px;
            font-weight: 700;
            transition: all 0.1s;
            cursor: pointer;
        }

        .btn:active {
            transform: scale(0.96);
        }

        .btn-primary {
            background: #8a2be2;
            color: white;
            border: 2px solid #8a2be2;
        }

        .btn-success {
            background: #8a2be2;
            color: white;
            border: 2px solid #8a2be2;
        }

        .hidden {
            display: none !important;
        }

        /* –ë—ã—Å—Ç—Ä—ã–µ —Å—Ç–∞–≤–∫–∏ */
        .quick-bets {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .quick-btn {
            flex: 1;
            background: #000000;
            border: 1px solid #8a2be2;
            border-radius: 20px;
            padding: 8px;
            color: #8a2be2;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
        }

        .quick-btn:active {
            background: #1a1a1a;
        }

        /* –ü—Ä–æ—Ñ–∏–ª—å */
        .profile-header {
            background: #000000;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            margin-bottom: 12px;
            border: 1px solid #8a2be2;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            background: #8a2be2;
            border-radius: 40px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
            border: 2px solid #8a2be2;
            box-shadow: 0 0 20px #8a2be2;
            overflow: hidden;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-name {
            color: white;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .profile-id {
            color: #8a2be2;
            font-size: 12px;
            margin-bottom: 16px;
        }

        .profile-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 16px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            color: white;
            font-size: 18px;
            font-weight: 700;
        }

        .stat-label {
            color: #8a2be2;
            font-size: 12px;
        }

        /* TON Connect —Å—Ç–∏–ª–∏ */
        .ton-connect-section {
            background: #000000;
            border-radius: 20px;
            padding: 20px;
            border: 2px solid #8a2be2;
            margin-bottom: 16px;
            text-align: center;
        }

        .ton-connect-title {
            color: #8a2be2;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .custom-amount-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .custom-amount-field {
            flex: 1;
            background: #000000;
            border: 2px solid #8a2be2;
            border-radius: 30px;
            padding: 15px;
            color: white;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            outline: none;
        }

        .custom-amount-field:focus {
            border-color: #9b4dff;
            box-shadow: 0 0 10px #8a2be2;
        }

        .custom-amount-btn {
            background: #8a2be2;
            color: white;
            border: none;
            border-radius: 30px;
            padding: 15px 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .custom-amount-btn:active {
            transform: scale(0.96);
        }

        .preset-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .preset-item {
            background: #000000;
            border: 2px solid #8a2be2;
            border-radius: 16px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .preset-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(138, 43, 226, 0.3);
        }

        .preset-item:active {
            transform: scale(0.95);
        }

        .preset-icon {
            font-size: 24px;
            margin-bottom: 5px;
            color: #8a2be2;
        }

        .preset-amount {
            color: white;
            font-weight: 700;
            font-size: 16px;
        }

        /* –ß–µ–∫ –¥–ª—è –æ–ø–ª–∞—Ç—ã */
        .check-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .check-modal.active {
            display: flex;
        }

        .check-content {
            background: #000000;
            border: 2px solid #8a2be2;
            border-radius: 30px;
            padding: 30px;
            max-width: 320px;
            text-align: center;
            position: relative;
            box-shadow: 0 0 50px rgba(138, 43, 226, 0.5);
        }

        .check-title {
            color: #8a2be2;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .check-icon {
            font-size: 80px;
            margin-bottom: 20px;
            color: #8a2be2;
        }

        .check-details {
            color: white;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .check-amount {
            color: #8a2be2;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .check-address {
            background: #1a1a1a;
            border: 1px solid #8a2be2;
            border-radius: 16px;
            padding: 12px;
            color: #8a2be2;
            font-size: 12px;
            margin-bottom: 20px;
            word-break: break-all;
        }

        .check-qr {
            width: 200px;
            height: 200px;
            background: #ffffff;
            margin: 0 auto 20px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: #000000;
        }

        .check-buttons {
            display: flex;
            gap: 10px;
        }

        .check-btn {
            flex: 1;
            background: #000000;
            border: 2px solid #8a2be2;
            border-radius: 30px;
            padding: 15px;
            color: #8a2be2;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .check-btn.pay {
            background: #8a2be2;
            color: white;
        }

        .check-btn:active {
            transform: scale(0.96);
        }

        .check-close {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #8a2be2;
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 1px solid #8a2be2;
        }

        /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å - –ø—É—Å—Ç–æ–π */
        .inventory-empty {
            text-align: center;
            padding: 40px;
            color: #8a2be2;
            border: 2px dashed #8a2be2;
            border-radius: 20px;
            margin-bottom: 12px;
        }

        .inventory-empty-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .inventory-empty-text {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .inventory-empty-sub {
            font-size: 12px;
            opacity: 0.7;
        }

        /* –ö–µ–π—Å—ã */
        .cases-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 12px;
        }

        .case-item {
            background: #000000;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            border: 2px solid #8a2be2;
            cursor: pointer;
            transition: all 0.2s;
        }

        .case-item:active {
            transform: scale(0.96);
            box-shadow: 0 0 20px #8a2be2;
        }

        .case-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .case-name {
            color: white;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .case-price {
            color: #8a2be2;
            font-size: 16px;
            font-weight: 600;
        }

        /* –ö–Ω–æ–ø–∫–∞ —Ñ–∏–∫—Å–∞—Ü–∏–∏ —Å—Ç–∞–≤–∫–∏ */
        .fix-bet-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .fix-bet-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #8a2be2;
        }

        .fix-bet-label {
            color: #8a2be2;
            font-size: 14px;
        }

        /* Win –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä */
        .win-indicator {
            position: absolute;
            top: 80px;
            right: 20px;
            color: #8a2be2;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 0 0 10px #8a2be2;
            z-index: 10;
        }

        /* –°—Ç—Ä–æ–∫–∞ —Å—Ç–∞–≤–æ–∫ */
        .bets-list {
            background: #000000;
            border-radius: 16px;
            padding: 12px;
            margin-top: 12px;
            border: 1px solid #8a2be2;
            max-height: 150px;
            overflow-y: auto;
        }

        .bets-title {
            color: #8a2be2;
            font-size: 12px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .bet-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 8px;
            border-bottom: 1px solid #333;
            color: white;
            font-size: 12px;
        }

        .bet-item:last-child {
            border-bottom: none;
        }

        .bet-user {
            color: #8a2be2;
        }

        .bet-amount {
            color: #ffd966;
        }

        .bet-mult {
            color: #2ecc71;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- CONTROL CENTER –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="control-center-header">CONTROL CENTER</div>

        <!-- –ë–∞–ª–∞–Ω—Å -->
        <div class="balance-row">
            <div class="balance-item">
                <span class="currency-icon">TON</span>
                <span id="balance-ton">0</span>
            </div>
            <div class="balance-item">
                <span class="currency-icon">‚≠ê</span>
                <span id="balance-stars">0</span>
            </div>
        </div>

        <!-- –ß–µ—Ç—ã—Ä–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é -->
        <div class="menu-buttons">
            <button class="menu-btn active" data-section="profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
            <button class="menu-btn" data-section="inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
            <button class="menu-btn" data-section="traffic">–†–∞–∫–µ—Ç–∞</button>
            <button class="menu-btn" data-section="cases">–ö–µ–π—Å—ã</button>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –ü—Ä–æ—Ñ–∏–ª—å -->
        <div id="profile-section" class="section active">
            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar">
                    üë§
                </div>
                <div class="profile-name" id="profileName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <div class="profile-id" id="profileId">ID: ...</div>
                <div class="profile-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="profileGames">0</div>
                        <div class="stat-label">–ò–≥—Ä</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="profileWins">0</div>
                        <div class="stat-label">–ü–æ–±–µ–¥</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="profileAvg">0x</div>
                        <div class="stat-label">–°—Ä. –º–Ω–æ–∂–∏—Ç–µ–ª—å</div>
                    </div>
                </div>
            </div>

            <!-- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ TON -->
            <div class="ton-connect-section">
                <div class="ton-connect-title">üíé –ü–æ–ø–æ–ª–Ω–∏—Ç—å TON</div>
                
                <!-- –ü–æ–ª–µ –¥–ª—è —Å–≤–æ–µ–π —Å—É–º–º—ã -->
                <div class="custom-amount-input">
                    <input type="number" id="tonAmount" class="custom-amount-field" placeholder="–°–≤–æ—è —Å—É–º–º–∞" min="1" value="10">
                    <button class="custom-amount-btn" onclick="createTonCheckFromInput()">–û–ø–ª–∞—Ç–∏—Ç—å</button>
                </div>
                
                <!-- –ë—ã—Å—Ç—Ä—ã–µ —Å—É–º–º—ã -->
                <div class="preset-grid">
                    <div class="preset-item" onclick="document.getElementById('tonAmount').value = '10'">
                        <div class="preset-icon">üíé</div>
                        <div class="preset-amount">10 TON</div>
                    </div>
                    <div class="preset-item" onclick="document.getElementById('tonAmount').value = '25'">
                        <div class="preset-icon">üíé</div>
                        <div class="preset-amount">25 TON</div>
                    </div>
                    <div class="preset-item" onclick="document.getElementById('tonAmount').value = '50'">
                        <div class="preset-icon">üíé</div>
                        <div class="preset-amount">50 TON</div>
                    </div>
                    <div class="preset-item" onclick="document.getElementById('tonAmount').value = '100'">
                        <div class="preset-icon">üíé</div>
                        <div class="preset-amount">100 TON</div>
                    </div>
                </div>
            </div>

            <!-- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ Stars -->
            <div class="ton-connect-section">
                <div class="ton-connect-title">‚≠ê –ü–æ–ø–æ–ª–Ω–∏—Ç—å Stars</div>
                
                <!-- –ü–æ–ª–µ –¥–ª—è —Å–≤–æ–µ–π —Å—É–º–º—ã -->
                <div class="custom-amount-input">
                    <input type="number" id="starsAmount" class="custom-amount-field" placeholder="–°–≤–æ—è —Å—É–º–º–∞" min="1" value="50">
                    <button class="custom-amount-btn" onclick="createStarsCheckFromInput()">–û–ø–ª–∞—Ç–∏—Ç—å</button>
                </div>
                
                <!-- –ë—ã—Å—Ç—Ä—ã–µ —Å—É–º–º—ã -->
                <div class="preset-grid">
                    <div class="preset-item" onclick="document.getElementById('starsAmount').value = '50'">
                        <div class="preset-icon">‚≠ê</div>
                        <div class="preset-amount">50 Stars</div>
                    </div>
                    <div class="preset-item" onclick="document.getElementById('starsAmount').value = '100'">
                        <div class="preset-icon">‚≠ê</div>
                        <div class="preset-amount">100 Stars</div>
                    </div>
                    <div class="preset-item" onclick="document.getElementById('starsAmount').value = '250'">
                        <div class="preset-icon">‚≠ê</div>
                        <div class="preset-amount">250 Stars</div>
                    </div>
                    <div class="preset-item" onclick="document.getElementById('starsAmount').value = '500'">
                        <div class="preset-icon">‚≠ê</div>
                        <div class="preset-amount">500 Stars</div>
                    </div>
                </div>
            </div>
            
            <div class="bet-section">
                <h3 style="color: #8a2be2; margin-bottom: 12px;">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
                <div style="background: #000000; border-radius: 12px; padding: 12px; margin-bottom: 8px; border: 1px solid #8a2be2;">
                    <div style="display: flex; justify-content: space-between; color: white;">
                        <span>üî• –ü–µ—Ä–≤–∞—è –∏–≥—Ä–∞</span>
                        <span style="color: #8a2be2;">0/1</span>
                    </div>
                </div>
                <div style="background: #000000; border-radius: 12px; padding: 12px; margin-bottom: 8px; border: 1px solid #8a2be2;">
                    <div style="display: flex; justify-content: space-between; color: white;">
                        <span>‚ö° –ü–µ—Ä–≤—ã–π –≤—ã–∏–≥—Ä—ã—à</span>
                        <span style="color: #8a2be2;">0/1</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å - –ø—É—Å—Ç–æ–π -->
        <div id="inventory-section" class="section">
            <div class="inventory-empty">
                <div class="inventory-empty-icon">üì¶</div>
                <div class="inventory-empty-text">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</div>
                <div class="inventory-empty-sub">–ö—É–ø–∏—Ç–µ –∫–µ–π—Å—ã —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã</div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –†–∞–∫–µ—Ç–∞ -->
        <div id="traffic-section" class="section">
            <!-- –ò–≥—Ä–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å -->
            <div class="game-area" id="game-area">
                <div class="multiplier" id="multiplier">1.00x</div>
                <div class="win-indicator hidden" id="win-indicator">‚úì WIN</div>
                <canvas id="gameCanvas"></canvas>
            </div>

            <!-- –°—Ç—Ä–æ–∫–∞ —Å—Ç–∞–≤–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ -->
            <div class="bets-list">
                <div class="bets-title">–ê–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞–≤–∫–∏</div>
                <div id="activeBets">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è -->
                </div>
            </div>

            <!-- –ò—Å—Ç–æ—Ä–∏—è -->
            <div class="history-container">
                <div class="history-label">–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä</div>
                <div id="history"></div>
            </div>

            <!-- –°—Ç–∞–≤–∫–∞ -->
            <div class="bet-section">
                <div class="fix-bet-container">
                    <input type="checkbox" id="fix-bet" class="fix-bet-checkbox">
                    <label for="fix-bet" class="fix-bet-label">–§–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞–≤–∫—É</label>
                </div>

                <!-- –í—ã–±–æ—Ä –≤–∞–ª—é—Ç—ã –Ω–∞–¥ –∫–Ω–æ–ø–∫–æ–π -->
                <div class="currency-selector">
                    <button class="curr-btn active" data-curr="ton">TON</button>
                    <button class="curr-btn" data-curr="stars">STARS</button>
                </div>

                <div class="bet-input-row">
                    <input type="number" id="bet-input" min="0.1" step="0.1" value="1.0">
                </div>

                <!-- –ë—ã—Å—Ç—Ä—ã–µ —Å—Ç–∞–≤–∫–∏ -->
                <div class="quick-bets">
                    <button class="quick-btn" data-mult="2">2x</button>
                    <button class="quick-btn" data-mult="5">5x</button>
                    <button class="quick-btn" data-mult="10">10x</button>
                    <button class="quick-btn" data-mult="50">50x</button>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                <div class="action-buttons">
                    <button class="btn btn-primary" id="bet-btn">–ü–æ—Å—Ç–∞–≤–∏—Ç—å</button>
                    <button class="btn btn-success hidden" id="cash-btn">–ó–∞–±—Ä–∞—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –ö–µ–π—Å—ã -->
        <div id="cases-section" class="section">
            <div class="cases-grid">
                <div class="case-item" onclick="openCase('common')">
                    <div class="case-icon">üì¶</div>
                    <div class="case-name">–û–±—ã—á–Ω—ã–π –∫–µ–π—Å</div>
                    <div class="case-price">50 Stars</div>
                </div>
                <div class="case-item" onclick="openCase('rare')">
                    <div class="case-icon">üéÅ</div>
                    <div class="case-name">–†–µ–¥–∫–∏–π –∫–µ–π—Å</div>
                    <div class="case-price">150 Stars</div>
                </div>
                <div class="case-item" onclick="openCase('epic')">
                    <div class="case-icon">üíé</div>
                    <div class="case-name">–≠–ø–∏—á–µ—Å–∫–∏–π –∫–µ–π—Å</div>
                    <div class="case-price">5 TON</div>
                </div>
                <div class="case-item" onclick="openCase('legendary')">
                    <div class="case-icon">üëë</div>
                    <div class="case-name">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π</div>
                    <div class="case-price">15 TON</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —á–µ–∫–æ–º -->
    <div class="check-modal" id="checkModal">
        <div class="check-content">
            <div class="check-close" onclick="closeCheck()">‚úï</div>
            <div class="check-icon" id="checkIcon">üíé</div>
            <div class="check-title" id="checkTitle">–°—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É</div>
            <div class="check-details">–ö –æ–ø–ª–∞—Ç–µ:</div>
            <div class="check-amount" id="checkAmount">0 TON</div>
            <div class="check-qr" id="checkQR">üì±</div>
            <div class="check-address" id="checkAddress">EQCD39VS5jcptHL8vMjEXrzGaRcCVYto7HUn4bpAOg8xqB2N</div>
            <div class="check-buttons">
                <button class="check-btn" onclick="closeCheck()">–û—Ç–º–µ–Ω–∞</button>
                <button class="check-btn pay" id="checkPayBtn" onclick="payCheck()">–û–ø–ª–∞—Ç–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            isPlaying: false,
            multiplier: 1.0,
            crashPoint: 2.5,
            rocket: { y: 0.5 },
            startTime: Date.now()
        };
        
        // –ê–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞–≤–∫–∏
        let activeBets = [];
        
        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        let currentUser = {
            id: null,
            firstName: '–ò–≥—Ä–æ–∫',
            lastName: '',
            username: '',
            photoUrl: null,
            ton: 0,
            stars: 0,
            games: 0,
            wins: 0,
            totalMultiplier: 0
        };
        
        // –¢–µ–∫—É—â–∏–π —á–µ–∫
        let currentCheck = {
            currency: 'ton',
            amount: 0,
            address: '',
            transactionId: null
        };
        
        // Canvas
        let canvas = document.getElementById('gameCanvas');
        let ctx = canvas.getContext('2d');
        let multEl = document.getElementById('multiplier');
        let winIndicator = document.getElementById('win-indicator');
        
        // –¢—Ä–∞—Ñ–∏–∫
        let trafficLines = [];
        const TRAFFIC_COUNT = 25;
        const TRAFFIC_SPEED = 0.04;
        
        // –§–∏–∫—Å–∞—Ü–∏—è —Å—Ç–∞–≤–∫–∏
        let fixBet = false;
        let currentCurr = 'ton';
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram
        function initTelegram() {
            if (window.Telegram?.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.ready();
                tg.expand();
                
                const user = tg.initDataUnsafe?.user;
                if (user) {
                    currentUser.id = user.id;
                    currentUser.firstName = user.first_name || '–ò–≥—Ä–æ–∫';
                    currentUser.lastName = user.last_name || '';
                    currentUser.username = user.username || '';
                    
                    document.getElementById('profileName').innerText = 
                        currentUser.firstName + (currentUser.lastName ? ' ' + currentUser.lastName : '');
                    document.getElementById('profileId').innerText = `ID: ${currentUser.id}`;
                    
                    if (user.photo_url) {
                        const avatarDiv = document.getElementById('profileAvatar');
                        avatarDiv.innerHTML = `<img src="${user.photo_url}" alt="avatar">`;
                    }
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–∞–ª–∞–Ω—Å
                    loadUserBalance();
                }
            } else {
                // –î–µ–º–æ —Ä–µ–∂–∏–º
                currentUser.id = 12345;
                currentUser.firstName = '–¢–µ—Å—Ç–æ–≤—ã–π';
                document.getElementById('profileName').innerText = '–¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                document.getElementById('profileId').innerText = 'ID: 12345';
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–ª–∞–Ω—Å–∞
        function loadUserBalance() {
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –±—ç–∫–µ–Ω–¥—É
            setTimeout(() => {
                updateUI();
            }, 500);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            document.getElementById('balance-ton').innerText = currentUser.ton;
            document.getElementById('balance-stars').innerText = currentUser.stars;
            document.getElementById('profileGames').innerText = currentUser.games;
            document.getElementById('profileWins').innerText = currentUser.wins;
            document.getElementById('profileAvg').innerText = 
                currentUser.games > 0 ? (currentUser.totalMultiplier / currentUser.games).toFixed(2) + 'x' : '0x';
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —á–µ–∫–∞ –¥–ª—è TON –∏–∑ –ø–æ–ª—è –≤–≤–æ–¥–∞
        function createTonCheckFromInput() {
            const amount = parseFloat(document.getElementById('tonAmount').value);
            if (isNaN(amount) || amount <= 0) {
                if (window.Telegram?.WebApp) {
                    window.Telegram.WebApp.showPopup({
                        title: '–û—à–∏–±–∫–∞',
                        message: '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É',
                        buttons: [{id: 'ok', type: 'ok', text: 'OK'}]
                    });
                }
                return;
            }
            createTonCheck(amount);
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —á–µ–∫–∞ –¥–ª—è TON
        function createTonCheck(amount) {
            currentCheck.currency = 'ton';
            currentCheck.amount = amount;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å –¥–ª—è –æ–ø–ª–∞—Ç—ã
            const baseAddress = 'EQCD39VS5jcptHL8vMjEXrzGaRcCVYto7HUn4bpAOg8xqB2N';
            currentCheck.address = baseAddress;
            currentCheck.transactionId = 'TON_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á–µ–∫
            document.getElementById('checkIcon').innerHTML = 'üíé';
            document.getElementById('checkTitle').innerHTML = '–°—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É TON';
            document.getElementById('checkAmount').innerHTML = amount + ' TON';
            document.getElementById('checkAddress').innerHTML = currentCheck.address;
            document.getElementById('checkQR').innerHTML = 'üíé';
            document.getElementById('checkPayBtn').setAttribute('onclick', 'payTonCheck()');
            
            document.getElementById('checkModal').classList.add('active');
            
            console.log('–°–æ–∑–¥–∞–Ω —á–µ–∫ TON:', currentCheck);
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —á–µ–∫–∞ –¥–ª—è Stars –∏–∑ –ø–æ–ª—è –≤–≤–æ–¥–∞
        function createStarsCheckFromInput() {
            const amount = parseFloat(document.getElementById('starsAmount').value);
            if (isNaN(amount) || amount <= 0) {
                if (window.Telegram?.WebApp) {
                    window.Telegram.WebApp.showPopup({
                        title: '–û—à–∏–±–∫–∞',
                        message: '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É',
                        buttons: [{id: 'ok', type: 'ok', text: 'OK'}]
                    });
                }
                return;
            }
            createStarsCheck(amount);
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —á–µ–∫–∞ –¥–ª—è Stars
        function createStarsCheck(amount) {
            currentCheck.currency = 'stars';
            currentCheck.amount = amount;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á–µ–∫
            document.getElementById('checkIcon').innerHTML = '‚≠ê';
            document.getElementById('checkTitle').innerHTML = '–û–ø–ª–∞—Ç–∞ Stars';
            document.getElementById('checkAmount').innerHTML = amount + ' Stars';
            document.getElementById('checkAddress').innerHTML = '–û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Telegram Stars';
            document.getElementById('checkQR').innerHTML = '‚≠ê';
            document.getElementById('checkPayBtn').setAttribute('onclick', 'payStarsCheck()');
            
            document.getElementById('checkModal').classList.add('active');
        }
        
        // –û–ø–ª–∞—Ç–∞ TON —á–µ–∫–∞
        function payTonCheck() {
            if (window.Telegram?.WebApp) {
                const tg = window.Telegram.WebApp;
                
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –∫–æ—à–µ–ª–µ–∫ –¥–ª—è –æ–ø–ª–∞—Ç—ã
                tg.openLink('ton://transfer/' + currentCheck.address + '?amount=' + (currentCheck.amount * 1000000000));
                
                // –ñ–¥–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                setTimeout(() => {
                    checkTonPayment();
                }, 30000);
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã TON
        function checkTonPayment() {
            if (window.Telegram?.WebApp) {
                const tg = window.Telegram.WebApp;
                
                tg.showPopup({
                    title: '–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã',
                    message: '–í—ã —É–∂–µ –æ–ø–ª–∞—Ç–∏–ª–∏ —Å—á–µ—Ç?',
                    buttons: [
                        {id: 'yes', type: 'default', text: '–î–∞, –æ–ø–ª–∞—Ç–∏–ª'},
                        {id: 'no', type: 'cancel', text: '–ù–µ—Ç'}
                    ]
                }, (buttonId) => {
                    if (buttonId === 'yes') {
                        // –î–æ–±–∞–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
                        currentUser.ton += currentCheck.amount;
                        updateUI();
                        closeCheck();
                        
                        tg.showPopup({
                            title: '–£—Å–ø–µ—à–Ω–æ',
                            message: `–ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${currentCheck.amount} TON`,
                            buttons: [{id: 'ok', type: 'ok', text: 'OK'}]
                        });
                        
                        console.log('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è TON –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞:', currentCheck);
                    }
                });
            }
        }
        
        // –û–ø–ª–∞—Ç–∞ Stars —á–µ–∫–∞
        function payStarsCheck() {
            if (window.Telegram?.WebApp) {
                const tg = window.Telegram.WebApp;
                
                tg.showPopup({
                    title: '–ü–æ–∫—É–ø–∫–∞ Stars',
                    message: `–ö—É–ø–∏—Ç—å ${currentCheck.amount} Stars –∑–∞ ${currentCheck.amount} Telegram Stars?`,
                    buttons: [
                        {id: 'buy', type: 'default', text: '–ö—É–ø–∏—Ç—å'},
                        {id: 'cancel', type: 'cancel', text: '–û—Ç–º–µ–Ω–∞'}
                    ]
                }, (buttonId) => {
                    if (buttonId === 'buy') {
                        // –î–æ–±–∞–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
                        currentUser.stars += currentCheck.amount;
                        updateUI();
                        closeCheck();
                        
                        tg.showPopup({
                            title: '–£—Å–ø–µ—à–Ω–æ',
                            message: `–í—ã –∫—É–ø–∏–ª–∏ ${currentCheck.amount} Stars!`,
                            buttons: [{id: 'ok', type: 'ok', text: 'OK'}]
                        });
                    }
                });
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å —á–µ–∫
        function closeCheck() {
            document.getElementById('checkModal').classList.remove('active');
        }
        
        // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–ø–ª–∞—Ç—ã
        function payCheck() {
            if (currentCheck.currency === 'ton') {
                payTonCheck();
            } else {
                payStarsCheck();
            }
        }
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–∞
        function openCase(caseType) {
            const prices = {
                common: { stars: 50 },
                rare: { stars: 150 },
                epic: { ton: 5 },
                legendary: { ton: 15 }
            };
            
            let price = prices[caseType];
            
            if (price.stars && currentUser.stars >= price.stars) {
                currentUser.stars -= price.stars;
                openCaseReward();
            } else if (price.ton && currentUser.ton >= price.ton) {
                currentUser.ton -= price.ton;
                openCaseReward();
            } else {
                if (window.Telegram?.WebApp) {
                    window.Telegram.WebApp.showPopup({
                        title: '–û—à–∏–±–∫–∞',
                        message: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤',
                        buttons: [{id: 'ok', type: 'ok', text: 'OK'}]
                    });
                }
            }
        }
        
        function openCaseReward() {
            if (window.Telegram?.WebApp) {
                window.Telegram.WebApp.showPopup({
                    title: '–ö–µ–π—Å –æ—Ç–∫—Ä—ã—Ç!',
                    message: '–í—ã –ø–æ–ª—É—á–∏–ª–∏ –ø—Ä–µ–¥–º–µ—Ç! (–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)',
                    buttons: [{id: 'ok', type: 'ok', text: 'OK'}]
                });
            }
            updateUI();
        }
        
        // –ò–≥—Ä–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function initTraffic() {
            trafficLines = [];
            for (let i = 0; i < TRAFFIC_COUNT; i++) {
                trafficLines.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    speed: 0.3 + Math.random() * 2.5,
                    width: 1 + Math.random() * 4,
                    length: 20 + Math.random() * 50,
                    alpha: 0.2 + Math.random() * 0.7
                });
            }
        }
        
        // –°–µ–∫—Ä–µ—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
        function getRandomCrashPoint(betAmount, currency) {
            if (currency === 'ton' && betAmount >= 50) {
                return 1.0;
            }
            
            const r = Math.random();
            if (r < 0.4) return 1.2 + Math.random() * 1.5;
            if (r < 0.7) return 2.7 + Math.random() * 3;
            if (r < 0.9) return 5.7 + Math.random() * 6;
            return 11.7 + Math.random() * 20;
        }
        
        function addActiveBet(userId, userName, amount, currency) {
            activeBets.push({
                userId,
                userName,
                amount,
                currency,
                multiplier: gameState.multiplier,
                time: Date.now()
            });
            
            updateBetsList();
        }
        
        function updateBetsList() {
            const betsDiv = document.getElementById('activeBets');
            betsDiv.innerHTML = '';
            
            activeBets.forEach(bet => {
                const betItem = document.createElement('div');
                betItem.className = 'bet-item';
                betItem.innerHTML = `
                    <span class="bet-user">${bet.userName}</span>
                    <span class="bet-amount">${bet.amount} ${bet.currency}</span>
                    <span class="bet-mult">${bet.multiplier.toFixed(2)}x</span>
                `;
                betsDiv.appendChild(betItem);
            });
        }
        
        function clearBets() {
            activeBets = [];
            updateBetsList();
        }
        
        function placeBet() {
            if (gameState.isPlaying) return;
            
            const amt = parseFloat(document.getElementById('bet-input').value);
            if (isNaN(amt) || amt <= 0) return;
            
            if (currentUser[currentCurr] < amt) {
                if (window.Telegram?.WebApp) {
                    window.Telegram.WebApp.showPopup({
                        title: '–û—à–∏–±–∫–∞',
                        message: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤',
                        buttons: [{id: 'ok', type: 'ok', text: 'OK'}]
                    });
                }
                return;
            }
            
            currentUser[currentCurr] -= amt;
            currentUser.games++;
            updateUI();
            
            addActiveBet(
                currentUser.id,
                currentUser.firstName,
                amt,
                currentCurr
            );
            
            gameState.isPlaying = true;
            gameState.hasCashedOut = false;
            gameState.multiplier = 1.0;
            gameState.crashPoint = getRandomCrashPoint(amt, currentCurr);
            gameState.startTime = Date.now();
            gameState.currentBet = amt;
            
            gameState.rocket.y = 0.5;
            
            initTraffic();
            
            document.getElementById('bet-btn').style.display = 'none';
            document.getElementById('cash-btn').style.display = 'block';
            winIndicator.classList.add('hidden');
            
            if (gameLoop) clearInterval(gameLoop);
            gameLoop = setInterval(update, 50);
        }
        
        function cashOut() {
            if (!gameState.isPlaying || gameState.hasCashedOut) return;
            
            const amt = gameState.currentBet;
            const win = amt * gameState.multiplier;
            
            currentUser[currentCurr] += win;
            currentUser.wins++;
            currentUser.totalMultiplier += gameState.multiplier;
            updateUI();
            
            gameState.hasCashedOut = true;
            
            const hist = document.getElementById('history');
            const item = document.createElement('div');
            item.className = 'hist-item';
            item.innerHTML = `
                <span>${currentUser.firstName}</span>
                <span style="color: #ffd966">${amt} ${currentCurr}</span>
                <span style="color: #2ecc71">‚úì ${gameState.multiplier.toFixed(2)}x</span>
            `;
            hist.prepend(item);
            
            activeBets = activeBets.filter(bet => bet.userId !== currentUser.id);
            updateBetsList();
            
            document.getElementById('cash-btn').style.display = 'none';
            document.getElementById('bet-btn').style.display = 'block';
            document.getElementById('bet-btn').disabled = true;
            document.getElementById('bet-btn').style.opacity = '0.5';
        }
        
        function finishGame(isWin) {
            clearInterval(gameLoop);
            gameState.isPlaying = false;
            
            document.getElementById('bet-btn').disabled = false;
            document.getElementById('bet-btn').style.opacity = '1';
            
            if (!isWin && !gameState.hasCashedOut) {
                const hist = document.getElementById('history');
                const item = document.createElement('div');
                item.className = 'hist-item';
                item.innerHTML = `
                    <span>üí• CRASH</span>
                    <span style="color: #ff4757">${gameState.multiplier.toFixed(2)}x</span>
                `;
                hist.prepend(item);
            }
            
            clearBets();
            
            setTimeout(() => {
                document.getElementById('bet-btn').style.display = 'block';
                document.getElementById('cash-btn').style.display = 'none';
                multEl.style.color = '#ffffff';
                multEl.innerText = '1.00x';
                winIndicator.classList.add('hidden');
                gameState.rocket.y = 0.5;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                trafficLines = [];
                drawStartScreen();
                
                if (fixBet) {
                    setTimeout(() => {
                        if (!gameState.isPlaying) {
                            placeBet();
                        }
                    }, 2100);
                }
            }, 2000);
        }
        
        function update() {
            if (!gameState.isPlaying) return;
            
            gameState.multiplier += 0.015;
            multEl.innerText = gameState.multiplier.toFixed(2) + 'x';
            
            gameState.rocket.y -= 0.015;
            if (gameState.rocket.y < 0.1) gameState.rocket.y = 0.1;
            
            updateTraffic();
            drawGame();
            
            if (!gameState.hasCashedOut && gameState.multiplier >= gameState.crashPoint) {
                finishGame(false);
            }
        }
        
        function updateTraffic() {
            for (let i = 0; i < trafficLines.length; i++) {
                const line = trafficLines[i];
                line.y -= line.speed * TRAFFIC_SPEED * canvas.height * (0.5 + gameState.multiplier * 0.5);
                
                if (line.y < -line.length) {
                    line.y = canvas.height + Math.random() * 50;
                    line.x = Math.random() * canvas.width;
                    line.speed = 0.3 + Math.random() * 2.5;
                }
            }
        }
        
        function drawGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = 'rgba(138, 43, 226, 0.1)';
            for (let i = 0; i < 30; i++) {
                ctx.beginPath();
                ctx.arc(
                    15 + (i * 23) % canvas.width, 
                    25 + (i * 17) % canvas.height, 
                    1 + i % 2, 
                    0, Math.PI * 2
                );
                ctx.fill();
            }
            
            if (trafficLines.length > 0) {
                drawTraffic();
            }
            
            ctx.save();
            ctx.strokeStyle = 'rgba(138, 43, 226, 0.15)';
            ctx.lineWidth = 1.5;
            ctx.setLineDash([8, 12]);
            ctx.beginPath();
            ctx.moveTo(canvas.width * 0.15, canvas.height - 20);
            ctx.lineTo(canvas.width * 0.85, 20);
            ctx.stroke();
            ctx.restore();
            
            ctx.save();
            const rocketX = canvas.width * 0.15 + (canvas.width * 0.7) * Math.min(gameState.multiplier / 12, 1);
            const rocketY = canvas.height - 20 - (canvas.height - 40) * Math.min(gameState.multiplier / 18, 1);
            
            ctx.translate(rocketX, rocketY);
            
            const angle = Math.atan2(-30, canvas.width * 0.7 / 12);
            ctx.rotate(angle * 0.5);
            
            ctx.shadowColor = '#8a2be2';
            ctx.shadowBlur = 20;
            
            ctx.fillStyle = '#8a2be2';
            ctx.beginPath();
            ctx.moveTo(0, -15);
            ctx.lineTo(10, 0);
            ctx.lineTo(3, 0);
            ctx.lineTo(3, 10);
            ctx.lineTo(-3, 10);
            ctx.lineTo(-3, 0);
            ctx.lineTo(-10, 0);
            ctx.closePath();
            ctx.fill();
            
            ctx.shadowColor = '#ffaa33';
            ctx.fillStyle = '#ffaa33';
            ctx.beginPath();
            ctx.moveTo(-3, 10);
            ctx.lineTo(0, 18);
            ctx.lineTo(3, 10);
            ctx.fill();
            
            ctx.restore();
        }
        
        function drawTraffic() {
            ctx.save();
            
            for (let i = 0; i < trafficLines.length; i++) {
                const line = trafficLines[i];
                
                ctx.strokeStyle = `rgba(138, 43, 226, ${line.alpha})`;
                ctx.lineWidth = line.width;
                ctx.lineCap = 'round';
                
                ctx.beginPath();
                ctx.moveTo(line.x, line.y);
                ctx.lineTo(line.x + 20, line.y - 20);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(line.x - 8, line.y + 5);
                ctx.lineTo(line.x + 12, line.y - 15);
                ctx.stroke();
                
                if (i % 2 === 0) {
                    ctx.fillStyle = `rgba(138, 43, 226, ${line.alpha * 0.8})`;
                    ctx.beginPath();
                    ctx.arc(line.x + 10, line.y - 10, line.width * 0.8, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            ctx.restore();
        }
        
        function drawStartScreen() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = 'rgba(138, 43, 226, 0.2)';
            for (let i = 0; i < 40; i++) {
                ctx.beginPath();
                ctx.arc(
                    Math.random() * canvas.width, 
                    Math.random() * canvas.height, 
                    1 + Math.random() * 2, 
                    0, Math.PI * 2
                );
                ctx.fill();
            }
            
            ctx.save();
            ctx.translate(canvas.width / 2, canvas.height - 50);
            ctx.fillStyle = '#8a2be2';
            ctx.shadowColor = '#8a2be2';
            ctx.shadowBlur = 15;
            
            ctx.beginPath();
            ctx.moveTo(0, -25);
            ctx.lineTo(12, 0);
            ctx.lineTo(4, 0);
            ctx.lineTo(4, 15);
            ctx.lineTo(-4, 15);
            ctx.lineTo(-4, 0);
            ctx.lineTo(-12, 0);
            ctx.closePath();
            ctx.fill();
            
            ctx.shadowBlur = 10;
            ctx.fillStyle = '#ffaa33';
            ctx.beginPath();
            ctx.moveTo(-4, 15);
            ctx.lineTo(0, 25);
            ctx.lineTo(4, 15);
            ctx.fill();
            ctx.restore();
            
            ctx.font = 'bold 14px system-ui, -apple-system, sans-serif';
            ctx.fillStyle = '#8a2be2';
            ctx.shadowBlur = 0;
            ctx.fillText('–°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É', canvas.width/2 - 70, canvas.height/2);
        }
        
        function resizeCanvas() {
            const rect = document.getElementById('game-area').getBoundingClientRect();
            if (rect.width > 0 && rect.height > 0) {
                canvas.width = rect.width;
                canvas.height = rect.height;
                
                if (!gameState.isPlaying) {
                    drawStartScreen();
                } else {
                    drawGame();
                }
            }
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–æ–≤
        document.querySelectorAll('.menu-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                const section = btn.dataset.section;
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById(section + '-section').classList.add('active');
                
                if (section === 'traffic') {
                    setTimeout(resizeCanvas, 50);
                }
            });
        });
        
        // –°–º–µ–Ω–∞ –≤–∞–ª—é—Ç—ã
        document.querySelectorAll('.curr-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.curr-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentCurr = btn.dataset.curr;
            });
        });
        
        // –ë—ã—Å—Ç—Ä—ã–µ —Å—Ç–∞–≤–∫–∏
        document.querySelectorAll('.quick-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const mult = parseFloat(btn.dataset.mult);
                const currentBet = parseFloat(document.getElementById('bet-input').value);
                document.getElementById('bet-input').value = (currentBet * mult).toFixed(1);
            });
        });
        
        // –§–∏–∫—Å–∞—Ü–∏—è —Å—Ç–∞–≤–∫–∏
        document.getElementById('fix-bet').addEventListener('change', (e) => {
            fixBet = e.target.checked;
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('bet-btn').addEventListener('click', placeBet);
        document.getElementById('cash-btn').addEventListener('click', cashOut);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('resize', () => {
            setTimeout(resizeCanvas, 50);
        });
        
        setTimeout(() => {
            resizeCanvas();
            initTraffic();
            updateUI();
            drawStartScreen();
            initTelegram();
        }, 100);
    </script>
</body>
</html>
