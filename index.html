<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CONTROL CENTER</title>
    <!-- TON Connect –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://unpkg.com/@tonconnect/ui@2.0.9/dist/tonconnect-ui.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #000000, #1a0033);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 8px;
            animation: bgPulse 10s infinite;
        }

        @keyframes bgPulse {
            0% { background: linear-gradient(135deg, #000000, #1a0033); }
            50% { background: linear-gradient(135deg, #1a0033, #330066); }
            100% { background: linear-gradient(135deg, #000000, #1a0033); }
        }

        .game-container {
            width: 100%;
            max-width: 380px;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 16px;
            border: 2px solid #8a2be2;
            box-shadow: 0 0 30px rgba(138, 43, 226, 0.5), 0 0 60px rgba(138, 43, 226, 0.3);
            animation: glowPulse 3s infinite;
        }

        @keyframes glowPulse {
            0% { box-shadow: 0 0 30px rgba(138, 43, 226, 0.5); }
            50% { box-shadow: 0 0 50px rgba(138, 43, 226, 0.8), 0 0 80px rgba(138, 43, 226, 0.5); }
            100% { box-shadow: 0 0 30px rgba(138, 43, 226, 0.5); }
        }

        .control-center-header {
            color: #8a2be2;
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px #8a2be2, 0 0 20px #8a2be2;
            border-bottom: 1px solid #8a2be2;
            padding-bottom: 10px;
            animation: textFlicker 3s infinite;
        }

        @keyframes textFlicker {
            0% { text-shadow: 0 0 10px #8a2be2; }
            50% { text-shadow: 0 0 20px #8a2be2, 0 0 40px #8a2be2; }
            100% { text-shadow: 0 0 10px #8a2be2; }
        }

        .menu-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .menu-btn {
            flex: 1;
            min-width: 70px;
            background: rgba(0,0,0,0.5);
            border: 2px solid #8a2be2;
            border-radius: 30px;
            padding: 12px 0;
            color: #8a2be2;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            backdrop-filter: blur(5px);
            position: relative;
            overflow: hidden;
        }

        .menu-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(138, 43, 226, 0.4), transparent);
            transition: 0.5s;
        }

        .menu-btn:hover::before {
            left: 100%;
        }

        .menu-btn.active {
            background: #8a2be2;
            color: white;
            border-color: #8a2be2;
            box-shadow: 0 0 20px #8a2be2, 0 0 40px #8a2be2;
            animation: btnPulse 1.5s infinite;
        }

        @keyframes btnPulse {
            0% { box-shadow: 0 0 20px #8a2be2; }
            50% { box-shadow: 0 0 40px #8a2be2, 0 0 60px #8a2be2; }
            100% { box-shadow: 0 0 20px #8a2be2; }
        }

        .balance-row {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 20px;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            border: 1px solid #8a2be2;
            border-radius: 50px;
            padding: 12px 16px;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .balance-item {
            padding: 5px 15px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 700;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(138, 43, 226, 0.2);
            border: 1px solid #8a2be2;
            position: relative;
            overflow: hidden;
        }

        .balance-item::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(138,43,226,0.3) 0%, transparent 70%);
            animation: rotate 10s linear infinite;
        }

        .ton-logo {
            width: 24px;
            height: 24px;
            background: #0088CC;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            position: relative;
            z-index: 1;
            animation: spin 10s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        /* –ò–≥—Ä–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å */
        .game-area {
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 12px;
            margin-bottom: 12px;
            border: 2px solid #8a2be2;
            aspect-ratio: 1/1;
            position: relative;
            box-shadow: inset 0 0 30px rgba(138, 43, 226, 0.3);
            animation: areaPulse 4s infinite;
            overflow: hidden;
        }

        @keyframes areaPulse {
            0% { box-shadow: inset 0 0 30px rgba(138, 43, 226, 0.3); }
            50% { box-shadow: inset 0 0 50px rgba(138, 43, 226, 0.5); }
            100% { box-shadow: inset 0 0 30px rgba(138, 43, 226, 0.3); }
        }

        #gameCanvas {
            width: 100%;
            height: 100%;
            display: block;
            border-radius: 12px;
            background: #000000;
        }

        .multiplier {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 28px;
            font-weight: 800;
            color: #ffffff;
            text-shadow: 0 0 20px #8a2be2, 0 0 40px #8a2be2;
            z-index: 10;
            background: rgba(0,0,0,0.7);
            padding: 4px 16px;
            border-radius: 30px;
            backdrop-filter: blur(4px);
            border: 1px solid #8a2be2;
            animation: multiplierPulse 1s infinite;
        }

        @keyframes multiplierPulse {
            0% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.05); }
            100% { transform: translateX(-50%) scale(1); }
        }

        .crash-timer {
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            font-weight: 800;
            color: #ff4757;
            text-shadow: 0 0 20px #ff4757, 0 0 40px #ff4757;
            z-index: 10;
            background: rgba(0,0,0,0.7);
            padding: 4px 16px;
            border-radius: 30px;
            backdrop-filter: blur(4px);
            border: 1px solid #ff4757;
            display: none;
        }

        .crash-timer.active {
            display: block;
            animation: timerPulse 1s infinite;
        }

        @keyframes timerPulse {
            0% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.1); }
            100% { transform: translateX(-50%) scale(1); }
        }

        .waiting-message {
            position: absolute;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 16px;
            font-weight: 600;
            color: #ffd966;
            text-shadow: 0 0 10px #ffd966;
            z-index: 10;
            background: rgba(0,0,0,0.7);
            padding: 8px 16px;
            border-radius: 30px;
            backdrop-filter: blur(4px);
            border: 1px solid #ffd966;
            display: none;
        }

        .waiting-message.active {
            display: block;
            animation: waitingPulse 1.5s infinite;
        }

        @keyframes waitingPulse {
            0% { opacity: 0.7; transform: translateX(-50%) scale(1); }
            50% { opacity: 1; transform: translateX(-50%) scale(1.05); }
            100% { opacity: 0.7; transform: translateX(-50%) scale(1); }
        }

        /* –ò—Å—Ç–æ—Ä–∏—è */
        .history-container {
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 12px;
            margin-bottom: 16px;
            border: 1px solid #8a2be2;
        }

        .history-label {
            color: #8a2be2;
            font-size: 12px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        #history {
            display: flex;
            flex-direction: column;
            gap: 4px;
            max-height: 100px;
            overflow-y: auto;
            padding: 4px;
        }

        .hist-item {
            background: rgba(0,0,0,0.5);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            border: 1px solid #8a2be2;
            color: #8a2be2;
            display: flex;
            justify-content: space-between;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* –°—Ç–∞–≤–∫–∞ */
        .bet-section {
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 16px;
            border: 1px solid #8a2be2;
        }

        .bet-input-row {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        #bet-input {
            flex: 1;
            background: rgba(0,0,0,0.5);
            border: 1px solid #8a2be2;
            border-radius: 30px;
            padding: 12px 16px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            outline: none;
            transition: all 0.3s;
        }

        #bet-input:focus {
            border-color: #9b4dff;
            box-shadow: 0 0 20px #8a2be2;
            transform: scale(1.02);
        }

        .currency-selector {
            display: flex;
            background: rgba(0,0,0,0.5);
            border-radius: 30px;
            padding: 4px;
            border: 1px solid #8a2be2;
            margin-bottom: 12px;
        }

        .curr-btn {
            flex: 1;
            background: none;
            border: none;
            color: #8a2be2;
            font-weight: 600;
            font-size: 14px;
            padding: 8px 0;
            border-radius: 30px;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .curr-btn.active {
            background: #8a2be2;
            color: white;
            box-shadow: 0 0 20px #8a2be2;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            min-width: 100px;
            border: none;
            border-radius: 40px;
            padding: 14px;
            font-size: 16px;
            font-weight: 700;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:active {
            transform: scale(0.96);
        }

        .btn-primary {
            background: #8a2be2;
            color: white;
            border: 2px solid #8a2be2;
            box-shadow: 0 0 20px #8a2be2;
        }

        .btn-success {
            background: #2ecc71;
            color: white;
            border: 2px solid #2ecc71;
            box-shadow: 0 0 20px #2ecc71;
        }

        .btn-warning {
            background: #ff9800;
            color: white;
            border: 2px solid #ff9800;
            box-shadow: 0 0 20px #ff9800;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: 2px solid #6c757d;
            box-shadow: 0 0 20px #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .hidden {
            display: none !important;
        }

        .quick-bets {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .quick-btn {
            flex: 1;
            background: rgba(0,0,0,0.5);
            border: 1px solid #8a2be2;
            border-radius: 20px;
            padding: 8px;
            color: #8a2be2;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-btn:hover {
            background: #8a2be2;
            color: white;
            box-shadow: 0 0 15px #8a2be2;
        }

        /* –ü—Ä–æ—Ñ–∏–ª—å */
        .profile-header {
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            margin-bottom: 12px;
            border: 1px solid #8a2be2;
            animation: float 6s infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            background: #8a2be2;
            border-radius: 40px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
            border: 2px solid #8a2be2;
            box-shadow: 0 0 30px #8a2be2;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-name {
            color: white;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            text-shadow: 0 0 10px #8a2be2;
        }

        .profile-id {
            color: #8a2be2;
            font-size: 12px;
            margin-bottom: 16px;
        }

        /* TON Connect —Å—Ç–∏–ª–∏ */
        .ton-connect-section {
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            border: 2px solid #8a2be2;
            margin-bottom: 16px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .ton-connect-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(138,43,226,0.2) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        .ton-connect-title {
            color: #8a2be2;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            z-index: 1;
        }

        .ton-logo-title {
            width: 30px;
            height: 30px;
            background: #0088CC;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 20px #0088CC; }
            50% { transform: scale(1.1); box-shadow: 0 0 40px #0088CC; }
            100% { transform: scale(1); box-shadow: 0 0 20px #0088CC; }
        }

        .custom-amount-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }

        .custom-amount-field {
            width: 100%;
            background: rgba(0,0,0,0.5);
            border: 2px solid #8a2be2;
            border-radius: 30px;
            padding: 12px;
            color: white;
            font-size: 16px;
            text-align: center;
            outline: none;
            transition: all 0.3s;
        }

        .custom-amount-field:focus {
            border-color: #9b4dff;
            box-shadow: 0 0 30px #8a2be2;
            transform: scale(1.02);
        }

        .custom-amount-btn {
            background: #8a2be2;
            color: white;
            border: none;
            border-radius: 30px;
            padding: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px #8a2be2;
        }

        .custom-amount-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }

        .custom-amount-btn:hover::before {
            left: 100%;
        }

        .preset-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
            position: relative;
            z-index: 1;
        }

        .preset-item {
            background: rgba(0,0,0,0.5);
            border: 2px solid #8a2be2;
            border-radius: 16px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .preset-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(138, 43, 226, 0.5);
            background: #8a2be2;
            color: white;
        }

        .preset-icon {
            font-size: 20px;
            margin-bottom: 5px;
            color: #8a2be2;
            transition: all 0.3s;
        }

        .preset-item:hover .preset-icon {
            color: white;
        }

        .preset-amount {
            color: white;
            font-weight: 700;
            font-size: 14px;
        }

        /* –ß–µ–∫ –¥–ª—è –æ–ø–ª–∞—Ç—ã */
        .check-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(10px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .check-modal.active {
            display: flex;
        }

        .check-content {
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(20px);
            border: 2px solid #8a2be2;
            border-radius: 30px;
            padding: 30px;
            max-width: 320px;
            width: 90%;
            text-align: center;
            position: relative;
            box-shadow: 0 0 50px #8a2be2;
            animation: popIn 0.5s ease;
        }

        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .check-title {
            color: #8a2be2;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #8a2be2;
        }

        .check-icon {
            font-size: 60px;
            margin-bottom: 20px;
            color: #8a2be2;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .check-details {
            color: white;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .check-amount {
            color: #8a2be2;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #8a2be2;
        }

        .check-address {
            background: rgba(0,0,0,0.5);
            border: 1px solid #8a2be2;
            border-radius: 16px;
            padding: 12px;
            color: #8a2be2;
            font-size: 12px;
            margin-bottom: 20px;
            word-break: break-all;
        }

        .check-buttons {
            display: flex;
            gap: 10px;
        }

        .check-btn {
            flex: 1;
            background: rgba(0,0,0,0.5);
            border: 2px solid #8a2be2;
            border-radius: 30px;
            padding: 12px;
            color: #8a2be2;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .check-btn:hover {
            background: #8a2be2;
            color: white;
            box-shadow: 0 0 20px #8a2be2;
        }

        .check-btn.pay {
            background: #8a2be2;
            color: white;
            box-shadow: 0 0 20px #8a2be2;
        }

        .check-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .check-close {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #8a2be2;
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 1px solid #8a2be2;
            transition: all 0.3s;
        }

        .check-close:hover {
            background: #8a2be2;
            color: white;
        }

        .check-close.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* –ö–µ–π—Å—ã */
        .cases-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 12px;
        }

        .case-item {
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            border: 2px solid #8a2be2;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            animation: caseFloat 6s infinite;
        }

        @keyframes caseFloat {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }

        .case-item:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px #8a2be2;
        }

        .case-icon {
            font-size: 40px;
            margin-bottom: 8px;
            animation: spin 20s linear infinite;
        }

        .case-name {
            color: white;
            font-weight: 700;
            margin-bottom: 4px;
            font-size: 14px;
            text-shadow: 0 0 10px #8a2be2;
        }

        .case-price {
            color: #8a2be2;
            font-size: 14px;
            font-weight: 600;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–∏–≥—Ä—ã—à–∞ */
        .win-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(10px);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .win-modal.active {
            display: flex;
        }

        .win-content {
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(20px);
            border: 3px solid #2ecc71;
            border-radius: 30px;
            padding: 30px;
            max-width: 320px;
            width: 90%;
            text-align: center;
            position: relative;
            box-shadow: 0 0 50px #2ecc71;
            animation: winPop 0.5s ease;
        }

        @keyframes winPop {
            0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
            100% { transform: scale(1) rotate(0); opacity: 1; }
        }

        .win-icon {
            font-size: 80px;
            margin-bottom: 20px;
            color: #2ecc71;
            animation: winBounce 2s infinite;
        }

        @keyframes winBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        .win-title {
            color: #2ecc71;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #2ecc71;
        }

        .win-equation {
            color: white;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(46, 204, 113, 0.1);
            border-radius: 20px;
            border: 1px solid #2ecc71;
        }

        .win-equation span {
            color: #2ecc71;
            font-weight: 700;
        }

        .win-total {
            color: #ffd966;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #ffd966;
        }

        .win-btn {
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 30px;
            padding: 14px 30px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            box-shadow: 0 0 20px #2ecc71;
        }

        .win-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 40px #2ecc71;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–∏–≥—Ä—ã—à–∞ –∏–∑ –∫–µ–π—Å–∞ */
        .prize-win-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(10px);
            z-index: 2500;
            justify-content: center;
            align-items: center;
        }

        .prize-win-modal.active {
            display: flex;
        }

        .prize-win-content {
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(20px);
            border: 2px solid #8a2be2;
            border-radius: 30px;
            padding: 30px;
            max-width: 300px;
            width: 90%;
            text-align: center;
            position: relative;
            box-shadow: 0 0 50px #8a2be2;
            animation: prizePop 0.5s ease;
        }

        @keyframes prizePop {
            0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
            100% { transform: scale(1) rotate(0); opacity: 1; }
        }

        .prize-win-icon {
            font-size: 80px;
            margin-bottom: 20px;
            color: #8a2be2;
            animation: prizeBounce 2s infinite;
        }

        @keyframes prizeBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        .prize-win-title {
            color: #8a2be2;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #8a2be2;
        }

        .prize-win-name {
            color: white;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(138, 43, 226, 0.2);
            border-radius: 30px;
            border: 1px solid #8a2be2;
        }

        .prize-win-btn {
            background: #8a2be2;
            color: white;
            border: none;
            border-radius: 30px;
            padding: 14px 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            box-shadow: 0 0 20px #8a2be2;
        }

        .prize-win-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 40px #8a2be2;
        }

        /* –†—É–ª–µ—Ç–∫–∞ */
        .roulette-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(10px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .roulette-modal.active {
            display: flex;
        }

        .roulette-content {
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(20px);
            border: 2px solid #8a2be2;
            border-radius: 30px;
            padding: 20px;
            max-width: 340px;
            width: 90%;
            text-align: center;
            position: relative;
            box-shadow: 0 0 50px #8a2be2;
            animation: rouletteSpin 0.5s ease;
        }

        @keyframes rouletteSpin {
            from { transform: rotate(-10deg) scale(0.5); opacity: 0; }
            to { transform: rotate(0) scale(1); opacity: 1; }
        }

        .roulette-title {
            color: #8a2be2;
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #8a2be2;
            animation: titleGlow 2s infinite;
        }

        @keyframes titleGlow {
            0% { text-shadow: 0 0 10px #8a2be2; }
            50% { text-shadow: 0 0 30px #8a2be2, 0 0 50px #8a2be2; }
            100% { text-shadow: 0 0 10px #8a2be2; }
        }

        .prize-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
            max-height: 250px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0,0,0,0.5);
            border-radius: 16px;
        }

        .prize-item {
            background: rgba(0,0,0,0.5);
            border: 1px solid #8a2be2;
            border-radius: 12px;
            padding: 8px 4px;
            text-align: center;
            font-size: 11px;
            transition: all 0.3s;
        }

        .prize-item.highlight {
            background: #8a2be2;
            border-color: white;
            box-shadow: 0 0 30px #8a2be2;
            transform: scale(1.1);
            z-index: 10;
        }

        .prize-icon {
            font-size: 24px;
            margin-bottom: 4px;
            animation: iconSpin 10s linear infinite;
        }

        @keyframes iconSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .prize-name {
            color: white;
            font-weight: 600;
        }

        .roulette-price {
            color: white;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .roulette-price span {
            color: #8a2be2;
            font-weight: 700;
            text-shadow: 0 0 10px #8a2be2;
        }

        .roulette-buttons {
            display: flex;
            gap: 10px;
        }

        .roulette-btn {
            flex: 1;
            background: rgba(0,0,0,0.5);
            border: 2px solid #8a2be2;
            border-radius: 30px;
            padding: 12px;
            color: #8a2be2;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .roulette-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }

        .roulette-btn:hover::before {
            left: 100%;
        }

        .roulette-btn:hover {
            background: #8a2be2;
            color: white;
            box-shadow: 0 0 20px #8a2be2;
        }

        .roulette-btn.pay {
            background: #8a2be2;
            color: white;
            box-shadow: 0 0 20px #8a2be2;
        }

        .roulette-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .roulette-close {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #8a2be2;
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 1px solid #8a2be2;
            transition: all 0.3s;
        }

        .roulette-close:hover {
            background: #8a2be2;
            color: white;
        }

        .roulette-close.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 12px;
        }

        .inventory-item {
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            border: 1px solid #8a2be2;
        }

        .inventory-item.nft {
            border-color: gold;
            box-shadow: 0 0 15px gold;
        }

        .item-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .item-name {
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .item-count {
            color: #8a2be2;
            font-size: 12px;
            margin-top: 4px;
        }

        .inventory-empty {
            text-align: center;
            padding: 30px;
            color: #8a2be2;
            border: 2px dashed #8a2be2;
            border-radius: 20px;
            margin-bottom: 12px;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            animation: float 6s infinite;
        }

        .inventory-empty-icon {
            font-size: 40px;
            margin-bottom: 10px;
            animation: bounce 2s infinite;
        }

        .inventory-empty-text {
            font-size: 16px;
            margin-bottom: 5px;
        }

        /* –ê–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ */
        .bets-list {
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 8px;
            margin-top: 8px;
            border: 1px solid #8a2be2;
            max-height: 100px;
            overflow-y: auto;
            font-size: 11px;
        }

        .bets-title {
            color: #8a2be2;
            font-size: 10px;
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .bet-item {
            display: flex;
            justify-content: space-between;
            padding: 4px 6px;
            color: white;
            font-size: 10px;
            animation: slideInLeft 0.3s ease;
        }

        @keyframes slideInLeft {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .bet-user {
            color: #8a2be2;
        }

        .bet-amount {
            color: #ffd966;
        }

        .bet-mult {
            color: #2ecc71;
        }

        /* –§–∏–∫—Å–∞—Ü–∏—è —Å—Ç–∞–≤–∫–∏ */
        .fix-bet-container {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            border: 1px solid #8a2be2;
        }

        .fix-bet-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #8a2be2;
        }

        .fix-bet-label {
            color: #8a2be2;
            font-size: 14px;
            font-weight: 600;
        }

        .fix-bet-hint {
            color: #ffd966;
            font-size: 11px;
            margin-left: auto;
        }

        .win-indicator {
            position: absolute;
            top: 50px;
            right: 10px;
            color: #2ecc71;
            font-size: 14px;
            font-weight: bold;
            text-shadow: 0 0 20px #2ecc71;
            z-index: 10;
            animation: winFlash 1s infinite;
        }

        @keyframes winFlash {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å */
        .admin-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 3000;
            display: none;
        }

        .admin-button {
            width: 40px;
            height: 40px;
            background: #8a2be2;
            border: 2px solid white;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 0 20px #8a2be2;
            animation: adminPulse 2s infinite;
        }

        @keyframes adminPulse {
            0% { box-shadow: 0 0 20px #8a2be2; }
            50% { box-shadow: 0 0 40px #8a2be2, 0 0 60px #8a2be2; }
            100% { box-shadow: 0 0 20px #8a2be2; }
        }

        .admin-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(10px);
            z-index: 4000;
            justify-content: center;
            align-items: center;
        }

        .admin-modal.active {
            display: flex;
        }

        .admin-content {
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(20px);
            border: 2px solid #8a2be2;
            border-radius: 30px;
            padding: 30px;
            max-width: 300px;
            width: 90%;
            text-align: center;
            position: relative;
            box-shadow: 0 0 50px #8a2be2;
        }

        .admin-title {
            color: #8a2be2;
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #8a2be2;
        }

        .admin-input, .admin-select {
            width: 100%;
            background: rgba(0,0,0,0.5);
            border: 2px solid #8a2be2;
            border-radius: 30px;
            padding: 12px;
            color: white;
            font-size: 14px;
            margin-bottom: 12px;
            outline: none;
        }

        .admin-input:focus, .admin-select:focus {
            border-color: #9b4dff;
            box-shadow: 0 0 20px #8a2be2;
        }

        .admin-buttons {
            display: flex;
            gap: 10px;
        }

        .admin-btn {
            flex: 1;
            background: rgba(0,0,0,0.5);
            border: 2px solid #8a2be2;
            border-radius: 30px;
            padding: 12px;
            color: #8a2be2;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .admin-btn:hover {
            background: #8a2be2;
            color: white;
            box-shadow: 0 0 20px #8a2be2;
        }

        .admin-btn.give {
            background: #8a2be2;
            color: white;
            box-shadow: 0 0 20px #8a2be2;
        }

        .admin-close {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #8a2be2;
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 1px solid #8a2be2;
            transition: all 0.3s;
        }

        .admin-close:hover {
            background: #8a2be2;
            color: white;
        }

        /* –°—Ç–∞—Ç—É—Å —Ç—Ä–∞—Ñ–∏–∫–∞ */
        .traffic-status {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: #8a2be2;
            font-size: 12px;
            background: rgba(0,0,0,0.5);
            padding: 4px 8px;
            border-radius: 12px;
            border: 1px solid #8a2be2;
            z-index: 10;
        }

        .fixed-bet-info {
            color: #ffd966;
            font-size: 12px;
            margin-top: 8px;
            text-align: center;
            padding: 8px;
            background: rgba(255, 217, 102, 0.1);
            border-radius: 12px;
            border: 1px solid #ffd966;
            animation: pulse 2s infinite;
        }

        /* TON Connect –∫–Ω–æ–ø–∫–∞ */
        #ton-connect-button {
            margin: 15px 0;
            display: flex;
            justify-content: center;
        }

        .wallet-status {
            color: #2ecc71;
            font-size: 12px;
            margin-top: 8px;
            padding: 8px;
            background: rgba(46, 204, 113, 0.1);
            border-radius: 12px;
            border: 1px solid #2ecc71;
        }

        .wallet-status.error {
            color: #ff4757;
            border-color: #ff4757;
            background: rgba(255, 71, 87, 0.1);
        }

        .quick-load {
            display: none !important;
        }

        /* –ê–¥–º–∏–Ω –∫–Ω–æ–ø–∫–∏ */
        .admin-only {
            display: none;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="control-center-header">CONTROL CENTER</div>

        <!-- –ë–∞–ª–∞–Ω—Å -->
        <div class="balance-row">
            <div class="balance-item">
                <div class="ton-logo">TON</div>
                <span id="balance-ton">0.00</span>
            </div>
            <div class="balance-item">
                <span class="currency-icon">‚≠ê</span>
                <span id="balance-stars">0</span>
            </div>
        </div>

        <!-- –ß–µ—Ç—ã—Ä–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é -->
        <div class="menu-buttons">
            <button class="menu-btn active" data-section="profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
            <button class="menu-btn" data-section="inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
            <button class="menu-btn" data-section="traffic">–¢—Ä–∞—Ñ–∏–∫</button>
            <button class="menu-btn" data-section="cases">–ö–µ–π—Å—ã</button>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –ü—Ä–æ—Ñ–∏–ª—å -->
        <div id="profile-section" class="section active">
            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar">üë§</div>
                <div class="profile-name" id="profileName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <div class="profile-id" id="profileId">ID: ...</div>
            </div>

            <!-- TON Connect –∫–Ω–æ–ø–∫–∞ -->
            <div class="ton-connect-section">
                <div class="ton-connect-title">
                    <div class="ton-logo-title">üíé</div>
                    –ö—Ä–∏–ø—Ç–æ –∫–æ—à–µ–ª–µ–∫
                </div>
                <div id="ton-connect-button"></div>
                <div id="walletInfo" class="wallet-status hidden"></div>
            </div>

            <!-- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ TON -->
            <div class="ton-connect-section">
                <div class="ton-connect-title">
                    <div class="ton-logo-title">TON</div>
                    –ü–æ–ø–æ–ª–Ω–∏—Ç—å TON
                </div>
                
                <button class="custom-amount-btn" onclick="buyTon()">üíé –ö—É–ø–∏—Ç—å TON</button>
                
                <div class="custom-amount-input">
                    <input type="number" id="tonAmount" class="custom-amount-field" placeholder="–°—É–º–º–∞ TON" min="1" value="10">
                </div>
                
                <div class="preset-grid">
                    <div class="preset-item" onclick="document.getElementById('tonAmount').value = '10'">
                        <div class="preset-icon">‚ö°</div>
                        <div class="preset-amount">10 TON</div>
                    </div>
                    <div class="preset-item" onclick="document.getElementById('tonAmount').value = '25'">
                        <div class="preset-icon">‚ö°</div>
                        <div class="preset-amount">25 TON</div>
                    </div>
                    <div class="preset-item" onclick="document.getElementById('tonAmount').value = '50'">
                        <div class="preset-icon">‚ö°</div>
                        <div class="preset-amount">50 TON</div>
                    </div>
                    <div class="preset-item" onclick="document.getElementById('tonAmount').value = '100'">
                        <div class="preset-icon">‚ö°</div>
                        <div class="preset-amount">100 TON</div>
                    </div>
                </div>
            </div>

            <!-- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ Stars —á–µ—Ä–µ–∑ sendData -->
            <div class="ton-connect-section">
                <div class="ton-connect-title">‚≠ê –ü–æ–ø–æ–ª–Ω–∏—Ç—å Stars</div>
                
                <button class="custom-amount-btn" onclick="requestStarsPayment()">‚≠ê –ö—É–ø–∏—Ç—å Stars</button>
                
                <div class="custom-amount-input">
                    <input type="number" id="starsAmount" class="custom-amount-field" placeholder="–°—É–º–º–∞ Stars" min="1" value="50">
                </div>
                
                <div class="preset-grid">
                    <div class="preset-item" onclick="document.getElementById('starsAmount').value = '50'">
                        <div class="preset-icon">‚≠ê</div>
                        <div class="preset-amount">50 Stars</div>
                    </div>
                    <div class="preset-item" onclick="document.getElementById('starsAmount').value = '100'">
                        <div class="preset-icon">‚≠ê</div>
                        <div class="preset-amount">100 Stars</div>
                    </div>
                    <div class="preset-item" onclick="document.getElementById('starsAmount').value = '250'">
                        <div class="preset-icon">‚≠ê</div>
                        <div class="preset-amount">250 Stars</div>
                    </div>
                    <div class="preset-item" onclick="document.getElementById('starsAmount').value = '500'">
                        <div class="preset-icon">‚≠ê</div>
                        <div class="preset-amount">500 Stars</div>
                    </div>
                </div>
            </div>

            <!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å (–≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º) -->
            <div id="adminSection" class="ton-connect-section admin-only">
                <div class="ton-connect-title">üëë –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</div>
                
                <div class="custom-amount-input">
                    <input type="number" id="adminTonAmount" class="custom-amount-field" placeholder="–°—É–º–º–∞ TON" min="1" value="100">
                </div>
                <button class="custom-amount-btn" onclick="giveAdminTon()">üíé –í—ã–¥–∞—Ç—å TON</button>
                
                <div class="custom-amount-input" style="margin-top: 10px;">
                    <input type="number" id="adminStarsAmount" class="custom-amount-field" placeholder="–°—É–º–º–∞ Stars" min="1" value="1000">
                </div>
                <button class="custom-amount-btn" onclick="giveAdminStars()">‚≠ê –í—ã–¥–∞—Ç—å Stars</button>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
        <div id="inventory-section" class="section">
            <div class="inventory-grid" id="inventoryGrid">
                <div class="inventory-empty">
                    <div class="inventory-empty-icon">üì¶</div>
                    <div class="inventory-empty-text">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</div>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –¢—Ä–∞—Ñ–∏–∫ -->
        <div id="traffic-section" class="section">
            <div class="game-area" id="game-area">
                <div class="multiplier" id="multiplier">1.00x</div>
                <div class="crash-timer" id="crashTimer">–°–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥: 10.0—Å</div>
                <div class="waiting-message" id="waitingMessage">–°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É!</div>
                <div class="traffic-status" id="trafficStatus">–¢—Ä–∞—Ñ–∏–∫: –∞–∫—Ç–∏–≤–µ–Ω</div>
                <div class="win-indicator hidden" id="win-indicator">‚úì WIN</div>
                <canvas id="gameCanvas"></canvas>
            </div>

            <div class="bets-list">
                <div class="bets-title">–ê–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞–≤–∫–∏</div>
                <div id="activeBets"></div>
            </div>

            <div class="history-container">
                <div class="history-label">–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä</div>
                <div id="history"></div>
            </div>

            <div class="bet-section">
                <div class="fix-bet-container">
                    <input type="checkbox" id="fix-bet" class="fix-bet-checkbox">
                    <label for="fix-bet" class="fix-bet-label">–§–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞–≤–∫—É</label>
                    <span class="fix-bet-hint" id="fix-bet-hint">(–Ω—É–∂–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è —Å—Ç–∞–≤–∫–∞)</span>
                </div>
                <div id="fixed-bet-info" class="fixed-bet-info hidden"></div>

                <div class="currency-selector">
                    <button class="curr-btn active" data-curr="ton">TON</button>
                    <button class="curr-btn" data-curr="stars">STARS</button>
                </div>

                <div class="bet-input-row">
                    <input type="number" id="bet-input" min="0.1" step="0.1" value="1.0">
                </div>

                <div class="quick-bets">
                    <button class="quick-btn" data-mult="2">2x</button>
                    <button class="quick-btn" data-mult="5">5x</button>
                    <button class="quick-btn" data-mult="10">10x</button>
                    <button class="quick-btn" data-mult="50">50x</button>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" id="bet-btn">–ü–æ—Å—Ç–∞–≤–∏—Ç—å</button>
                    <button class="btn btn-success hidden" id="cash-btn">–ó–∞–±—Ä–∞—Ç—å</button>
                    <button class="btn btn-warning hidden" id="collect-traffic-btn" onclick="collectTraffic()">üö¶ –ó–∞–±—Ä–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫</button>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –ö–µ–π—Å—ã -->
        <div id="cases-section" class="section">
            <div class="cases-grid">
                <div class="case-item" onclick="openRoulette('common')">
                    <div class="case-icon">üì¶</div>
                    <div class="case-name">–û–±—ã—á–Ω—ã–π</div>
                    <div class="case-price">50 ‚≠ê</div>
                </div>
                <div class="case-item" onclick="openRoulette('rare')">
                    <div class="case-icon">üéÅ</div>
                    <div class="case-name">–†–µ–¥–∫–∏–π</div>
                    <div class="case-price">150 ‚≠ê</div>
                </div>
                <div class="case-item" onclick="openRoulette('epic')">
                    <div class="case-icon">üíé</div>
                    <div class="case-name">–≠–ø–∏—á–µ—Å–∫–∏–π</div>
                    <div class="case-price">5 TON</div>
                </div>
                <div class="case-item" onclick="openRoulette('legendary')">
                    <div class="case-icon">üëë</div>
                    <div class="case-name">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π</div>
                    <div class="case-price">15 TON</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–∏–≥—Ä—ã—à–∞ -->
    <div class="win-modal" id="winModal">
        <div class="win-content">
            <div class="win-icon">üéâ</div>
            <div class="win-title">–í–´ –í–´–ò–ì–†–ê–õ–ò!</div>
            <div class="win-equation" id="winEquation"></div>
            <div class="win-total" id="winTotal"></div>
            <button class="win-btn" onclick="closeWinModal()">–ó–ê–ö–†–´–¢–¨</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ä—É–ª–µ—Ç–∫–æ–π -->
    <div class="roulette-modal" id="rouletteModal">
        <div class="roulette-content">
            <div class="roulette-close" id="rouletteClose" onclick="closeRoulette()">‚úï</div>
            <div class="roulette-title" id="rouletteTitle">–ö–µ–π—Å</div>
            
            <div class="prize-grid" id="prizeGrid"></div>
            
            <div class="roulette-price" id="roulettePrice">–¶–µ–Ω–∞: <span>0</span></div>
            
            <div class="roulette-buttons">
                <button class="roulette-btn" onclick="closeRoulette()">–û—Ç–º–µ–Ω–∞</button>
                <button class="roulette-btn pay" id="roulettePayBtn" onclick="spinRoulette()">–ö—Ä—É—Ç–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–∏–≥—Ä—ã—à–∞ –∏–∑ –∫–µ–π—Å–∞ -->
    <div class="prize-win-modal" id="prizeWinModal">
        <div class="prize-win-content">
            <div class="prize-win-icon" id="prizeWinIcon">üéâ</div>
            <div class="prize-win-title">–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú!</div>
            <div class="prize-win-name" id="prizeWinName">–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –ø—Ä–∏–∑!</div>
            <button class="prize-win-btn" onclick="closePrizeWinModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ID –∞–¥–º–∏–Ω–∞
        const TON_WALLET = 'UQBUTuGvSDgrb9yfIYOdD_-JVfHo_VC_u4nghpFWFe5aP7Bl';
        const ADMIN_IDS = [594190]; // –¢–æ–ª—å–∫–æ ID 594190
        
        // TON Connect
        let tonConnectUI = null;
        let walletConnected = false;
        let walletAddress = '';
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            isPlaying: true,
            multiplier: 1.0,
            crashPoint: 1.5,
            rocketY: 0.5,
            roundActive: false,
            crashTimer: 10,
            isCrashActive: true,
            trafficCollected: false
        };
        
        // –ê–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞–≤–∫–∏
        let activeBets = [];
        
        // –§–æ–Ω–æ–≤—ã–µ –ª–∏–Ω–∏–∏
        let backgroundLines = [];
        const BACKGROUND_LINE_COUNT = 30;
        
        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage —Å—Ä–∞–∑—É
        let currentUser = {
            id: null,
            firstName: '–ò–≥—Ä–æ–∫',
            lastName: '',
            username: '',
            photoUrl: null,
            ton: 0,
            stars: 0,
            games: 0,
            wins: 0,
            inventory: [],
            trafficCollected: 0
        };
        
        // –¢–µ–∫—É—â–∏–π –∫–µ–π—Å
        let currentCase = {
            type: 'common',
            price: { stars: 50 }
        };
        
        // Canvas
        let canvas = document.getElementById('gameCanvas');
        let ctx = canvas.getContext('2d');
        let multEl = document.getElementById('multiplier');
        let crashTimerEl = document.getElementById('crashTimer');
        let waitingMessageEl = document.getElementById('waitingMessage');
        let trafficStatusEl = document.getElementById('trafficStatus');
        let winIndicator = document.getElementById('win-indicator');
        let fixedBetInfoEl = document.getElementById('fixed-bet-info');
        let fixBetHintEl = document.getElementById('fix-bet-hint');
        let collectTrafficBtn = document.getElementById('collect-traffic-btn');
        let winModal = document.getElementById('winModal');
        let winEquation = document.getElementById('winEquation');
        let winTotal = document.getElementById('winTotal');
        let profileAvatar = document.getElementById('profileAvatar');
        let profileName = document.getElementById('profileName');
        let profileId = document.getElementById('profileId');
        let rouletteClose = document.getElementById('rouletteClose');
        let walletInfo = document.getElementById('walletInfo');
        let adminSection = document.getElementById('adminSection');
        
        // –ó–ï–õ–ï–ù–ê–Ø –ª–∏–Ω–∏—è
        let trafficLine = {
            startX: 30,
            startY: 330,
            endX: 300,
            endY: 30,
            progress: 0,
            maxProgress: 0.75,
            speed: 0.0004,
            width: 14,
            alpha: 1.0
        };
        
        let animationFrame = null;
        
        // –§–ª–∞–≥ –¥–ª—è —Å—Ç–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        let userHasBet = false;
        let userBetAmount = 0;
        let userBetCurrency = 'ton';
        let userBetMultiplier = 1.0;
        let userFixedMultiplier = 1.0;
        
        // –§–ª–∞–≥ –¥–ª—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        let isBigBetActive = false;
        let hasCrashedThisRound = false;
        
        // –§–∏–∫—Å–∞—Ü–∏—è —Å—Ç–∞–≤–∫–∏
        let fixBetActive = false;
        let fixedMultiplier = 2;
        
        // –¢–µ–∫—É—â–∞—è –≤–∞–ª—é—Ç–∞
        let currentCurr = 'ton';
        
        // –ò–º–µ–Ω–∞ –±–æ—Ç–æ–≤
        let botNames = ['CryptoKing', 'MoonHunter', 'RocketMan', 'StarGazer', 'TONWhale', 'LuckyBot', 'RiskTaker', 'CoinMaster'];
        
        // –§–ª–∞–≥ –¥–ª—è —Ä—É–ª–µ—Ç–∫–∏
        let isRouletteSpinning = false;
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É
        loadUserData();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º TON Connect
            initTonConnect();
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram
            loadTelegramUser();
            
            initBackgroundLines();
            updateUI();
            updateInventory();
            startGameLoop();
            setInterval(addRandomBotBet, 8000);
            
            setTimeout(() => {
                resizeCanvas();
            }, 100);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function loadUserData() {
            const savedData = localStorage.getItem('controlCenterUser');
            if (savedData) {
                try {
                    const userData = JSON.parse(savedData);
                    currentUser.id = userData.id || null;
                    currentUser.firstName = userData.firstName || '–ò–≥—Ä–æ–∫';
                    currentUser.lastName = userData.lastName || '';
                    currentUser.username = userData.username || '';
                    currentUser.ton = userData.ton || 0;
                    currentUser.stars = userData.stars || 0;
                    currentUser.games = userData.games || 0;
                    currentUser.wins = userData.wins || 0;
                    currentUser.inventory = userData.inventory || [];
                    currentUser.trafficCollected = userData.trafficCollected || 0;
                    
                    // –°—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    profileName.innerText = currentUser.firstName;
                    profileId.innerText = `ID: ${currentUser.id || '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}`;
                } catch (e) {
                    console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                }
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function saveUserData() {
            const userData = {
                id: currentUser.id,
                firstName: currentUser.firstName,
                lastName: currentUser.lastName,
                username: currentUser.username,
                ton: currentUser.ton,
                stars: currentUser.stars,
                games: currentUser.games,
                wins: currentUser.wins,
                inventory: currentUser.inventory,
                trafficCollected: currentUser.trafficCollected
            };
            localStorage.setItem('controlCenterUser', JSON.stringify(userData));
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TON Connect
        function initTonConnect() {
            try {
                tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
                    manifestUrl: 'https://raw.githubusercontent.com/ton-connect/demo-dapp/main/public/tonconnect-manifest.json',
                    buttonRootId: 'ton-connect-button'
                });
                
                tonConnectUI.onStatusChange((wallet) => {
                    if (wallet) {
                        walletConnected = true;
                        walletAddress = wallet.account.address;
                        walletInfo.classList.remove('hidden');
                        walletInfo.classList.remove('error');
                        walletInfo.innerHTML = `‚úÖ –ö–æ—à–µ–ª–µ–∫: ${walletAddress.slice(0,6)}...${walletAddress.slice(-4)}`;
                    } else {
                        walletConnected = false;
                        walletAddress = '';
                        walletInfo.classList.add('hidden');
                    }
                });
                
            } catch (e) {
                console.log('TON Connect –æ—à–∏–±–∫–∞:', e);
                walletInfo.classList.remove('hidden');
                walletInfo.classList.add('error');
                walletInfo.innerHTML = '‚ö†Ô∏è TON Connect –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω';
            }
        }
        
        // –ü–æ–∫—É–ø–∫–∞ TON —á–µ—Ä–µ–∑ –∫–æ—à–µ–ª–µ–∫
        async function buyTon() {
            const amount = parseFloat(document.getElementById('tonAmount').value);
            if (isNaN(amount) || amount <= 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É');
                return;
            }
            
            if (!tonConnectUI || !tonConnectUI.connected) {
                alert('‚ùå –°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –≤—ã—à–µ');
                return;
            }
            
            try {
                const transaction = {
                    validUntil: Math.floor(Date.now() / 1000) + 600,
                    messages: [
                        {
                            address: TON_WALLET,
                            amount: (amount * 1000000000).toString()
                        }
                    ]
                };
                
                const result = await tonConnectUI.sendTransaction(transaction);
                
                if (result) {
                    currentUser.ton += amount;
                    updateUI();
                    alert(`‚úÖ –ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${amount} TON —á–µ—Ä–µ–∑ –∫–æ—à–µ–ª–µ–∫`);
                }
            } catch (e) {
                alert('‚ùå –û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: ' + e.message);
            }
        }
        
        // –ü–æ–∫—É–ø–∫–∞ Stars —á–µ—Ä–µ–∑ sendData (–∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ)
        function requestStarsPayment() {
            const amount = document.getElementById('starsAmount').value;
            
            if (!amount || amount <= 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É');
                return;
            }
            
            if (window.Telegram?.WebApp) {
                const tg = window.Telegram.WebApp;
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
                tg.sendData(JSON.stringify({
                    action: "buy_stars", 
                    amount: amount,
                    user_id: currentUser.id
                }));
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º
                alert('–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –±–æ—Ç—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–∞—Ç –¥–ª—è –æ–ø–ª–∞—Ç—ã.');
                tg.close();
            } else {
                alert('‚ùå –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ Telegram');
            }
        }
        
        // –ê–¥–º–∏–Ω —Ñ—É–Ω–∫—Ü–∏–∏
        function giveAdminTon() {
            const amount = parseFloat(document.getElementById('adminTonAmount').value);
            if (isNaN(amount) || amount <= 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É');
                return;
            }
            
            currentUser.ton += amount;
            updateUI();
            alert(`‚úÖ –í—ã–¥–∞–Ω–æ ${amount} TON`);
        }
        
        function giveAdminStars() {
            const amount = parseFloat(document.getElementById('adminStarsAmount').value);
            if (isNaN(amount) || amount <= 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É');
                return;
            }
            
            currentUser.stars += amount;
            updateUI();
            alert(`‚úÖ –í—ã–¥–∞–Ω–æ ${amount} Stars`);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram
        function loadTelegramUser() {
            if (window.Telegram?.WebApp) {
                try {
                    const tg = window.Telegram.WebApp;
                    tg.ready();
                    
                    const user = tg.initDataUnsafe?.user;
                    if (user) {
                        currentUser.id = user.id;
                        currentUser.firstName = user.first_name || '–ò–≥—Ä–æ–∫';
                        currentUser.lastName = user.last_name || '';
                        currentUser.username = user.username || '';
                        
                        profileName.innerText = currentUser.firstName + (currentUser.lastName ? ' ' + currentUser.lastName : '');
                        profileId.innerText = `ID: ${currentUser.id}`;
                        
                        if (user.photo_url) {
                            profileAvatar.innerHTML = `<img src="${user.photo_url}" alt="avatar" style="width:100%; height:100%; object-fit:cover;">`;
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–¥–º–∏–Ω–∞ (—Ç–æ–ª—å–∫–æ ID 594190)
                        if (ADMIN_IDS.includes(currentUser.id)) {
                            adminSection.classList.remove('admin-only');
                        }
                    }
                } catch (e) {
                    console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Telegram –¥–∞–Ω–Ω—ã—Ö');
                }
            }
            
            // –ï—Å–ª–∏ –Ω–µ—Ç ID, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∏–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π
            if (!currentUser.id) {
                const savedId = localStorage.getItem('controlCenterUserId');
                if (savedId) {
                    currentUser.id = parseInt(savedId);
                } else {
                    currentUser.id = Math.floor(Math.random() * 1000000);
                    localStorage.setItem('controlCenterUserId', currentUser.id);
                }
                profileName.innerText = currentUser.firstName;
                profileId.innerText = `ID: ${currentUser.id}`;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            saveUserData();
            console.log("–ü—Ä–æ—Ñ–∏–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω, ID:", currentUser.id);
        }
        
        function initBackgroundLines() {
            for (let i = 0; i < BACKGROUND_LINE_COUNT; i++) {
                backgroundLines.push({
                    x: canvas.width ? Math.random() * canvas.width : 200,
                    y: canvas.height ? Math.random() * canvas.height : 200,
                    length: 20 + Math.random() * 40,
                    speed: 0.5 + Math.random() * 1.5,
                    width: 1 + Math.random() * 2,
                    alpha: 0.1 + Math.random() * 0.2
                });
            }
        }
        
        function resizeCanvas() {
            const rect = document.getElementById('game-area').getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            trafficLine.startX = 30;
            trafficLine.startY = canvas.height - 50;
            trafficLine.endX = canvas.width - 30;
            trafficLine.endY = 30;
            
            for (let i = 0; i < backgroundLines.length; i++) {
                backgroundLines[i].x = Math.random() * canvas.width;
                backgroundLines[i].y = Math.random() * canvas.height;
            }
        }
        
        function updateUI() {
            document.getElementById('balance-ton').innerText = currentUser.ton.toFixed(2);
            document.getElementById('balance-stars').innerText = currentUser.stars;
            trafficStatusEl.innerText = `–¢—Ä–∞—Ñ–∏–∫: ${gameState.trafficCollected ? '—Å–æ–±—Ä–∞–Ω' : '–∞–∫—Ç–∏–≤–µ–Ω'} | –°–æ–±—Ä–∞–Ω–æ: ${currentUser.trafficCollected}`;
            
            if (gameState.isCrashActive) {
                if (userHasBet) {
                    waitingMessageEl.innerText = '–û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ —Ä–∞—É–Ω–¥–∞...';
                    waitingMessageEl.classList.add('active');
                } else {
                    waitingMessageEl.innerText = '–°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É!';
                    waitingMessageEl.classList.add('active');
                }
            } else if (gameState.roundActive) {
                waitingMessageEl.classList.remove('active');
            }
            
            if (fixBetActive && userHasBet) {
                fixedBetInfoEl.classList.remove('hidden');
                fixedBetInfoEl.innerHTML = `‚úÖ –°—Ç–∞–≤–∫–∞ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞: ${userBetAmount} ${userBetCurrency} x${fixedMultiplier}`;
            } else {
                fixedBetInfoEl.classList.add('hidden');
            }
            
            if (!userHasBet) {
                fixBetHintEl.style.color = '#ff4757';
            } else {
                fixBetHintEl.style.color = '#ffd966';
            }
            
            if (userHasBet) {
                collectTrafficBtn.classList.remove('hidden');
            } else {
                collectTrafficBtn.classList.add('hidden');
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
            saveUserData();
        }
        
        function updateInventory() {
            const grid = document.getElementById('inventoryGrid');
            
            if (currentUser.inventory.length === 0) {
                grid.innerHTML = `
                    <div class="inventory-empty">
                        <div class="inventory-empty-icon">üì¶</div>
                        <div class="inventory-empty-text">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</div>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = '';
            currentUser.inventory.forEach((item) => {
                const div = document.createElement('div');
                div.className = `inventory-item ${item.type === 'nft' ? 'nft' : ''}`;
                div.innerHTML = `
                    <div class="item-icon">${item.icon}</div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-count">x${item.count || 1}</div>
                `;
                grid.appendChild(div);
            });
        }
        
        function addToInventory(item) {
            const existing = currentUser.inventory.find(i => i.name === item.name);
            if (existing) {
                existing.count = (existing.count || 1) + 1;
            } else {
                currentUser.inventory.push({ ...item, count: 1 });
            }
            updateInventory();
            saveUserData();
        }
        
        function collectTraffic() {
            if (gameState.trafficCollected) {
                alert('–¢—Ä–∞—Ñ–∏–∫ —É–∂–µ —Å–æ–±—Ä–∞–Ω –≤ —ç—Ç–æ–º —Ä–∞—É–Ω–¥–µ!');
                return;
            }
            
            if (!gameState.roundActive || gameState.isCrashActive) {
                alert('–°–æ–±–∏—Ä–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞—É–Ω–¥–∞!');
                return;
            }
            
            if (!userHasBet) {
                alert('–°–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É!');
                return;
            }
            
            const currency = userBetCurrency;
            const reward = userBetAmount * gameState.multiplier;
            
            if (currency === 'ton') {
                currentUser.ton += reward;
            } else {
                currentUser.stars += reward;
            }
            
            currentUser.trafficCollected++;
            gameState.trafficCollected = true;
            
            updateUI();
            
            alert(`‚úÖ –¢—Ä–∞—Ñ–∏–∫ —Å–æ–±—Ä–∞–Ω! +${reward.toFixed(2)} ${currency.toUpperCase()}`);
            
            const hist = document.getElementById('history');
            const item = document.createElement('div');
            item.className = 'hist-item';
            item.innerHTML = `
                <span>${currentUser.firstName}</span>
                <span style="color: #ff9800">üö¶ –¢—Ä–∞—Ñ–∏–∫</span>
                <span style="color: #2ecc71">+${reward.toFixed(2)} ${currency}</span>
                <span style="color: #fff">${gameState.multiplier.toFixed(2)}x</span>
            `;
            hist.prepend(item);
        }
        
        function getRandomCrashPoint() {
            const r = Math.random() * 100;
            
            if (r < 40) {
                return 1.0 + Math.random() * 0.5;
            }
            else if (r < 70) {
                return 1.5 + Math.random() * 0.5;
            }
            else if (r < 85) {
                return 2.0 + Math.random() * 0.5;
            }
            else if (r < 95) {
                return 2.5 + Math.random() * 0.5;
            }
            else if (r < 99) {
                return 3.0 + Math.random() * 2.0;
            }
            else {
                return 5.0 + Math.random() * 5.0;
            }
        }
        
        function startGameLoop() {
            hasCrashedThisRound = false;
            
            if (isBigBetActive) {
                gameState.crashPoint = 1.01;
            } else {
                gameState.crashPoint = getRandomCrashPoint();
            }
            
            gameState.multiplier = 1.0;
            gameState.rocketY = 0.5;
            
            gameState.roundActive = false;
            gameState.isCrashActive = true;
            gameState.crashTimer = 10;
            gameState.trafficCollected = false;
            
            trafficLine.progress = 0;
            
            crashTimerEl.classList.add('active');
            updateUI();
            updateBetButtonState();
            
            function loop() {
                if (gameState.isCrashActive) {
                    gameState.crashTimer -= 0.016;
                    crashTimerEl.innerText = `–°–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥: ${Math.max(0, gameState.crashTimer).toFixed(1)}—Å`;
                    
                    if (gameState.crashTimer <= 0) {
                        gameState.isCrashActive = false;
                        gameState.roundActive = true;
                        
                        if (isBigBetActive) {
                            gameState.crashPoint = 1.01;
                        } else {
                            gameState.crashPoint = getRandomCrashPoint();
                        }
                        
                        gameState.multiplier = 1.0;
                        gameState.rocketY = 0.5;
                        gameState.trafficCollected = false;
                        crashTimerEl.classList.remove('active');
                        
                        trafficLine.progress = 0;
                        
                        activeBets = activeBets.filter(bet => bet.userId === (currentUser.id || 'user'));
                        updateBetsList();
                        
                        updateBetButtonState();
                        updateUI();
                    }
                } else if (gameState.roundActive) {
                    let speed;
                    if (gameState.multiplier < 2) {
                        speed = 0.0006;
                    } else if (gameState.multiplier < 4) {
                        speed = 0.0005;
                    } else if (gameState.multiplier < 6) {
                        speed = 0.0004;
                    } else {
                        speed = 0.0008;
                    }
                    
                    gameState.multiplier += speed;
                    
                    if (isBigBetActive && !hasCrashedThisRound) {
                        if (gameState.multiplier >= 1.01) {
                            gameState.multiplier = 1.01;
                            hasCrashedThisRound = true;
                            
                            gameState.roundActive = false;
                            gameState.isCrashActive = true;
                            gameState.crashTimer = 10;
                            crashTimerEl.classList.add('active');
                            
                            if (userHasBet) {
                                const lostAmount = userBetAmount;
                                const lostCurrency = userBetCurrency;
                                
                                userHasBet = false;
                                fixBetActive = false;
                                document.getElementById('fix-bet').checked = false;
                                document.getElementById('cash-btn').style.display = 'none';
                                document.getElementById('bet-btn').style.display = 'block';
                                
                                const hist = document.getElementById('history');
                                const item = document.createElement('div');
                                item.className = 'hist-item';
                                item.innerHTML = `
                                    <span>${currentUser.firstName}</span>
                                    <span style="color: #ff4757">üí• CRASH</span>
                                    <span style="color: #ffd966">-${lostAmount} ${lostCurrency}</span>
                                    <span style="color: #fff">1.01x</span>
                                `;
                                hist.prepend(item);
                            }
                            
                            isBigBetActive = false;
                            
                            updateUI();
                            updateBetButtonState();
                        }
                    } else {
                        if (gameState.multiplier >= gameState.crashPoint) {
                            gameState.roundActive = false;
                            gameState.isCrashActive = true;
                            gameState.crashTimer = 10;
                            crashTimerEl.classList.add('active');
                            
                            if (userHasBet) {
                                const lostAmount = userBetAmount;
                                const lostCurrency = userBetCurrency;
                                
                                userHasBet = false;
                                fixBetActive = false;
                                document.getElementById('fix-bet').checked = false;
                                document.getElementById('cash-btn').style.display = 'none';
                                document.getElementById('bet-btn').style.display = 'block';
                                
                                const hist = document.getElementById('history');
                                const item = document.createElement('div');
                                item.className = 'hist-item';
                                item.innerHTML = `
                                    <span>${currentUser.firstName}</span>
                                    <span style="color: #ff4757">üí• CRASH</span>
                                    <span style="color: #ffd966">-${lostAmount} ${lostCurrency}</span>
                                    <span style="color: #fff">${gameState.crashPoint.toFixed(2)}x</span>
                                `;
                                hist.prepend(item);
                            }
                            
                            updateUI();
                            updateBetButtonState();
                        }
                    }
                    
                    gameState.rocketY -= speed * 0.5;
                    if (gameState.rocketY < 0.1) gameState.rocketY = 0.1;
                    
                    if (trafficLine.progress < trafficLine.maxProgress) {
                        trafficLine.progress += trafficLine.speed;
                    }
                    
                    updateBackgroundLines();
                }
                
                multEl.innerText = gameState.multiplier.toFixed(2) + 'x';
                
                drawGame();
                
                animationFrame = requestAnimationFrame(loop);
            }
            
            animationFrame = requestAnimationFrame(loop);
        }
        
        function updateBackgroundLines() {
            for (let i = 0; i < backgroundLines.length; i++) {
                const line = backgroundLines[i];
                
                line.x -= line.speed;
                line.y += line.speed;
                
                if (line.x < -50 || line.y > canvas.height + 50) {
                    line.x = canvas.width + 50;
                    line.y = -50;
                }
            }
        }
        
        function updateBetButtonState() {
            const betBtn = document.getElementById('bet-btn');
            const cashBtn = document.getElementById('cash-btn');
            
            if (userHasBet) {
                betBtn.style.display = 'none';
                cashBtn.style.display = 'block';
            } else {
                betBtn.style.display = 'block';
                cashBtn.style.display = 'none';
                
                if (gameState.isCrashActive) {
                    betBtn.classList.remove('btn-secondary');
                    betBtn.classList.add('btn-primary');
                    betBtn.disabled = false;
                    betBtn.innerText = '–ü–æ—Å—Ç–∞–≤–∏—Ç—å';
                } else {
                    betBtn.classList.remove('btn-primary');
                    betBtn.classList.add('btn-secondary');
                    betBtn.disabled = true;
                    betBtn.innerText = '–ò–≥—Ä–∞ –∏–¥–µ—Ç';
                }
            }
        }
        
        function drawGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.save();
            for (let i = 0; i < backgroundLines.length; i++) {
                const line = backgroundLines[i];
                
                ctx.beginPath();
                ctx.strokeStyle = 'rgba(138, 43, 226, ' + line.alpha + ')';
                ctx.lineWidth = line.width;
                ctx.moveTo(line.x, line.y);
                ctx.lineTo(line.x + 20, line.y - 20);
                ctx.stroke();
            }
            ctx.restore();
            
            const color = '#2ecc71';
            
            const currentX = trafficLine.startX + (trafficLine.endX - trafficLine.startX) * trafficLine.progress;
            const currentY = trafficLine.startY + (trafficLine.endY - trafficLine.startY) * trafficLine.progress;
            
            ctx.save();
            ctx.beginPath();
            ctx.strokeStyle = color;
            ctx.shadowColor = color;
            ctx.shadowBlur = 30;
            ctx.lineWidth = trafficLine.width;
            ctx.globalAlpha = 1.0;
            
            ctx.moveTo(trafficLine.startX, trafficLine.startY);
            ctx.lineTo(currentX, currentY);
            ctx.stroke();
            
            ctx.shadowBlur = 50;
            ctx.lineWidth = trafficLine.width + 4;
            ctx.globalAlpha = 0.5;
            ctx.stroke();
            ctx.restore();
            
            ctx.save();
            ctx.fillStyle = color;
            ctx.shadowColor = color;
            ctx.shadowBlur = 30;
            ctx.beginPath();
            ctx.arc(trafficLine.startX, trafficLine.startY, 12, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(currentX, currentY, 12, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
            
            if (gameState.roundActive) {
                ctx.save();
                const rocketX = 20 + (canvas.width - 40) * 0.5;
                const rocketY = canvas.height - 20 - (canvas.height - 40) * gameState.rocketY;
                
                ctx.shadowColor = '#8a2be2';
                ctx.shadowBlur = 20;
                ctx.fillStyle = '#8a2be2';
                
                ctx.beginPath();
                ctx.arc(rocketX, rocketY, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }
        
        function addRandomBotBet() {
            if (!gameState.isCrashActive) return;
            if (Math.random() > 0.4) {
                const name = botNames[Math.floor(Math.random() * botNames.length)];
                const currency = Math.random() > 0.5 ? 'ton' : 'stars';
                const amount = (Math.random() * 5 + 0.5).toFixed(1);
                
                activeBets.push({
                    userId: 'bot_' + Date.now() + Math.random(),
                    userName: name,
                    amount: parseFloat(amount),
                    currency: currency,
                    multiplier: 1.0
                });
                
                if (activeBets.length > 8) {
                    activeBets = activeBets.slice(-8);
                }
                
                updateBetsList();
            }
        }
        
        function updateBetsList() {
            const betsDiv = document.getElementById('activeBets');
            betsDiv.innerHTML = '';
            activeBets.slice(-6).forEach(bet => {
                const div = document.createElement('div');
                div.className = 'bet-item';
                div.innerHTML = `
                    <span class="bet-user">${bet.userName}</span>
                    <span class="bet-amount">${bet.amount} ${bet.currency}</span>
                    <span class="bet-mult">${bet.multiplier ? bet.multiplier.toFixed(2) + 'x' : '1.00x'}</span>
                `;
                betsDiv.appendChild(div);
            });
        }
        
        function placeBet() {
            const amt = parseFloat(document.getElementById('bet-input').value);
            if (isNaN(amt) || amt <= 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É');
                return;
            }
            
            if (!gameState.isCrashActive) {
                alert('–°—Ç–∞–≤–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –º–µ–∂–¥—É —Ä–∞—É–Ω–¥–∞–º–∏!');
                return;
            }
            
            if (userHasBet) {
                alert('–í—ã —É–∂–µ —Å–¥–µ–ª–∞–ª–∏ —Å—Ç–∞–≤–∫—É');
                return;
            }
            
            if (currentUser[currentCurr] < amt) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
                return;
            }
            
            if (currentCurr === 'ton' && amt >= 50) {
                isBigBetActive = true;
            }
            
            currentUser[currentCurr] -= amt;
            currentUser.games++;
            
            userHasBet = true;
            userBetAmount = amt;
            userBetCurrency = currentCurr;
            userBetMultiplier = 1.0;
            userFixedMultiplier = 1.0;
            
            if (fixBetActive) {
                userBetMultiplier = fixedMultiplier;
                userFixedMultiplier = fixedMultiplier;
            }
            
            activeBets.push({
                userId: currentUser.id || 'user',
                userName: currentUser.firstName,
                amount: amt,
                currency: currentCurr,
                multiplier: 1.0,
                targetMultiplier: fixBetActive ? fixedMultiplier : null
            });
            
            updateBetsList();
            updateBetButtonState();
            updateUI();
            
            const hist = document.getElementById('history');
            const item = document.createElement('div');
            item.className = 'hist-item';
            item.innerHTML = `
                <span>${currentUser.firstName}</span>
                <span style="color: #ffd966">${amt} ${currentCurr}</span>
                <span style="color: #8a2be2">üì• –°—Ç–∞–≤–∫–∞</span>
            `;
            hist.prepend(item);
        }
        
        function cashOut() {
            if (!gameState.roundActive || gameState.isCrashActive) {
                alert('–°–µ–π—á–∞—Å –Ω–µ–ª—å–∑—è –∑–∞–±—Ä–∞—Ç—å —Å—Ç–∞–≤–∫—É');
                return;
            }
            
            if (!userHasBet) {
                alert('–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ç–∞–≤–∫–∏');
                return;
            }
            
            let winMultiplier;
            if (fixBetActive && userFixedMultiplier > 1) {
                winMultiplier = userFixedMultiplier;
            } else {
                winMultiplier = gameState.multiplier;
            }
            
            const win = userBetAmount * winMultiplier;
            
            if (userBetCurrency === 'ton') {
                currentUser.ton += win;
            } else {
                currentUser.stars += win;
            }
            
            currentUser.wins++;
            
            winEquation.innerHTML = `${userBetAmount.toFixed(2)} ${userBetCurrency} √ó ${winMultiplier.toFixed(2)}x`;
            winTotal.innerHTML = `= ${win.toFixed(2)} ${userBetCurrency}`;
            winModal.classList.add('active');
            
            fixBetActive = false;
            document.getElementById('fix-bet').checked = false;
            
            activeBets = activeBets.filter(b => b.userId !== (currentUser.id || 'user'));
            userHasBet = false;
            updateBetsList();
            
            const hist = document.getElementById('history');
            const item = document.createElement('div');
            item.className = 'hist-item';
            item.innerHTML = `
                <span>${currentUser.firstName}</span>
                <span style="color: #ffd966">${userBetAmount.toFixed(2)} ${userBetCurrency}</span>
                <span style="color: #2ecc71">‚úì ${winMultiplier.toFixed(2)}x</span>
                <span style="color: #fff">= ${win.toFixed(2)} ${userBetCurrency}</span>
            `;
            hist.prepend(item);
            
            updateBetButtonState();
            updateUI();
            winIndicator.classList.remove('hidden');
            
            setTimeout(() => {
                winIndicator.classList.add('hidden');
            }, 2000);
        }
        
        function closeWinModal() {
            winModal.classList.remove('active');
        }
        
        document.getElementById('fix-bet').addEventListener('change', (e) => {
            if (!userHasBet) {
                alert('–°–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É!');
                document.getElementById('fix-bet').checked = false;
                return;
            }
            
            fixBetActive = e.target.checked;
            
            if (fixBetActive) {
                userBetMultiplier = fixedMultiplier;
                userFixedMultiplier = fixedMultiplier;
                alert(`‚úÖ –§–∏–∫—Å–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞! –í–∞—à –≤—ã–∏–≥—Ä—ã—à –±—É–¥–µ—Ç x${fixedMultiplier} (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–æ—Å—Ç–∞ –º–Ω–æ–∂–∏—Ç–µ–ª—è)`);
            } else {
                userBetMultiplier = 1.0;
                userFixedMultiplier = 1.0;
                alert('‚ùå –§–∏–∫—Å–∞—Ü–∏—è –≤—ã–∫–ª—é—á–µ–Ω–∞. –í—ã–∏–≥—Ä—ã—à –±—É–¥–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –º–Ω–æ–∂–∏—Ç–µ–ª—è');
            }
            
            updateUI();
        });
        
        document.querySelectorAll('.quick-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const mult = parseFloat(btn.dataset.mult);
                const currentBet = parseFloat(document.getElementById('bet-input').value);
                document.getElementById('bet-input').value = (currentBet * mult).toFixed(1);
                
                if (fixBetActive) {
                    fixedMultiplier = mult;
                    if (userHasBet) {
                        userBetMultiplier = mult;
                        userFixedMultiplier = mult;
                    }
                    updateUI();
                }
            });
        });
        
        document.querySelectorAll('.curr-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.curr-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentCurr = btn.dataset.curr;
            });
        });
        
        document.getElementById('bet-btn').addEventListener('click', placeBet);
        document.getElementById('cash-btn').addEventListener('click', cashOut);
        
        window.addEventListener('resize', () => {
            setTimeout(resizeCanvas, 50);
        });
        
        document.querySelectorAll('.menu-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                const section = btn.dataset.section;
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById(section + '-section').classList.add('active');
                
                if (section === 'traffic') {
                    setTimeout(resizeCanvas, 50);
                }
            });
        });
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏
        window.buyTon = buyTon;
        window.requestStarsPayment = requestStarsPayment;
        window.giveAdminTon = giveAdminTon;
        window.giveAdminStars = giveAdminStars;
        
        init();

        function openRoulette(type) {
            currentCase.type = type;
            
            let prizes = [];
            let title = '';
            let price = '';
            
            switch(type) {
                case 'common':
                    title = '–û–±—ã—á–Ω—ã–π –∫–µ–π—Å';
                    price = '50 ‚≠ê';
                    currentCase.price = { stars: 50 };
                    prizes = [
                        { name: '10 ‚≠ê', icon: '‚≠ê', type: 'stars', amount: 10 },
                        { name: '15 ‚≠ê', icon: '‚≠ê', type: 'stars', amount: 15 },
                        { name: '20 ‚≠ê', icon: '‚≠ê', type: 'stars', amount: 20 },
                        { name: '25 ‚≠ê', icon: '‚≠ê', type: 'stars', amount: 25 },
                        { name: '30 ‚≠ê', icon: '‚≠ê', type: 'stars', amount: 30 },
                        { name: '35 ‚≠ê', icon: '‚≠ê', type: 'stars', amount: 35 },
                        { name: '40 ‚≠ê', icon: '‚≠ê', type: 'stars', amount: 40 },
                        { name: '45 ‚≠ê', icon: '‚≠ê', type: 'stars', amount: 45 },
                        { name: '50 ‚≠ê', icon: '‚≠ê', type: 'stars', amount: 50 },
                        { name: 'NFT –û–±—ã—á–Ω—ã–π', icon: 'üé®', type: 'nft' },
                        { name: '100 ‚≠ê (–î–∂–µ–∫–ø–æ—Ç!)', icon: 'üíé', type: 'stars', amount: 100 }
                    ];
                    break;
                case 'rare':
                    title = '–†–µ–¥–∫–∏–π –∫–µ–π—Å';
                    price = '150 ‚≠ê';
                    currentCase.price = { stars: 150 };
                    prizes = [
                        { name: '50 ‚≠ê', icon: '‚≠ê', type: 'stars', amount: 50 },
                        { name: '75 ‚≠ê', icon: '‚≠ê', type: 'stars', amount: 75 },
                        { name: '100 ‚≠ê', icon: '‚≠ê', type: 'stars', amount: 100 },
                        { name: '125 ‚≠ê', icon: '‚≠ê', type: 'stars', amount: 125 },
                        { name: '150 ‚≠ê', icon: '‚≠ê', type: 'stars', amount: 150 },
                        { name: '175 ‚≠ê', icon: '‚≠ê', type: 'stars', amount: 175 },
                        { name: '200 ‚≠ê', icon: '‚≠ê', type: 'stars', amount: 200 },
                        { name: '225 ‚≠ê', icon: '‚≠ê', type: 'stars', amount: 225 },
                        { name: '250 ‚≠ê', icon: '‚≠ê', type: 'stars', amount: 250 },
                        { name: 'NFT –†–µ–¥–∫–∏–π', icon: 'üé®', type: 'nft' },
                        { name: '500 ‚≠ê (–î–∂–µ–∫–ø–æ—Ç!)', icon: 'üëë', type: 'stars', amount: 500 }
                    ];
                    break;
                case 'epic':
                    title = '–≠–ø–∏—á–µ—Å–∫–∏–π –∫–µ–π—Å';
                    price = '5 TON';
                    currentCase.price = { ton: 5 };
                    prizes = [
                        { name: '1 TON', icon: 'üíé', type: 'ton', amount: 1 },
                        { name: '2 TON', icon: 'üíé', type: 'ton', amount: 2 },
                        { name: '3 TON', icon: 'üíé', type: 'ton', amount: 3 },
                        { name: '4 TON', icon: 'üíé', type: 'ton', amount: 4 },
                        { name: '5 TON', icon: 'üíé', type: 'ton', amount: 5 },
                        { name: '6 TON', icon: 'üíé', type: 'ton', amount: 6 },
                        { name: '7 TON', icon: 'üíé', type: 'ton', amount: 7 },
                        { name: '8 TON', icon: 'üíé', type: 'ton', amount: 8 },
                        { name: '10 TON', icon: 'üíé', type: 'ton', amount: 10 },
                        { name: 'NFT –≠–ø–∏—á–µ—Å–∫–∏–π', icon: 'üé®', type: 'nft' },
                        { name: '25 TON (–î–∂–µ–∫–ø–æ—Ç!)', icon: 'üëë', type: 'ton', amount: 25 }
                    ];
                    break;
                case 'legendary':
                    title = '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∫–µ–π—Å';
                    price = '15 TON';
                    currentCase.price = { ton: 15 };
                    prizes = [
                        { name: '5 TON', icon: 'üíé', type: 'ton', amount: 5 },
                        { name: '8 TON', icon: 'üíé', type: 'ton', amount: 8 },
                        { name: '10 TON', icon: 'üíé', type: 'ton', amount: 10 },
                        { name: '12 TON', icon: 'üíé', type: 'ton', amount: 12 },
                        { name: '15 TON', icon: 'üíé', type: 'ton', amount: 15 },
                        { name: '18 TON', icon: 'üíé', type: 'ton', amount: 18 },
                        { name: '20 TON', icon: 'üíé', type: 'ton', amount: 20 },
                        { name: '25 TON', icon: 'üíé', type: 'ton', amount: 25 },
                        { name: '30 TON', icon: 'üíé', type: 'ton', amount: 30 },
                        { name: 'NFT –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π', icon: 'üëë', type: 'nft' },
                        { name: '100 TON (–î–∂–µ–∫–ø–æ—Ç!)', icon: 'üíé', type: 'ton', amount: 100 }
                    ];
                    break;
            }
            
            roulettePrizes = prizes;
            
            const prizeGrid = document.getElementById('prizeGrid');
            prizeGrid.innerHTML = '';
            
            prizes.forEach((prize, index) => {
                const div = document.createElement('div');
                div.className = 'prize-item';
                div.id = `prize-${index}`;
                div.innerHTML = `
                    <div class="prize-icon">${prize.icon}</div>
                    <div class="prize-name">${prize.name}</div>
                `;
                prizeGrid.appendChild(div);
            });
            
            document.getElementById('rouletteTitle').innerText = title;
            document.getElementById('roulettePrice').innerHTML = `–¶–µ–Ω–∞: <span>${price}</span>`;
            document.getElementById('roulettePayBtn').disabled = false;
            document.getElementById('roulettePayBtn').innerText = '–ö—Ä—É—Ç–∏—Ç—å';
            document.getElementById('rouletteModal').classList.add('active');
        }

        function closeRoulette() {
            if (!isRouletteSpinning) {
                if (rouletteInterval) {
                    clearTimeout(rouletteInterval);
                    rouletteInterval = null;
                }
                document.getElementById('rouletteModal').classList.remove('active');
            }
        }

        let rouletteInterval = null;
        let roulettePrizes = [];
        let rouletteWinnerIndex = 0;

        function spinRoulette() {
            if (currentCase.price.stars && currentUser.stars < currentCase.price.stars) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Stars');
                return;
            }
            if (currentCase.price.ton && currentUser.ton < currentCase.price.ton) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON');
                return;
            }
            
            if (currentCase.price.stars) {
                currentUser.stars -= currentCase.price.stars;
            } else {
                currentUser.ton -= currentCase.price.ton;
            }
            updateUI();
            
            const prize = generatePrize(currentCase.type);
            
            let winnerIndex = 0;
            for (let i = 0; i < roulettePrizes.length; i++) {
                if (roulettePrizes[i].name === prize.name) {
                    winnerIndex = i;
                    break;
                }
            }
            
            rouletteWinnerIndex = winnerIndex;
            
            document.getElementById('roulettePayBtn').disabled = true;
            document.getElementById('roulettePayBtn').innerText = '–ö—Ä—É—Ç–∏—Ç—Å—è...';
            
            isRouletteSpinning = true;
            rouletteClose.classList.add('disabled');
            
            let currentIndex = 0;
            const startTime = Date.now();
            const totalTime = 5000;
            
            function highlightItem(index) {
                document.querySelectorAll('.prize-item').forEach(el => el.classList.remove('highlight'));
                document.getElementById(`prize-${index}`).classList.add('highlight');
            }
            
            function step() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / totalTime, 1);
                
                if (elapsed >= totalTime) {
                    highlightItem(rouletteWinnerIndex);
                    
                    if (prize.type === 'stars') {
                        currentUser.stars += prize.amount;
                    } else if (prize.type === 'ton') {
                        currentUser.ton += prize.amount;
                    } else if (prize.type === 'nft') {
                        addToInventory(prize);
                    }
                    updateUI();
                    
                    showPrizeWinModal(prize);
                    
                    document.getElementById('roulettePayBtn').disabled = false;
                    document.getElementById('roulettePayBtn').innerText = '–ö—Ä—É—Ç–∏—Ç—å';
                    
                    isRouletteSpinning = false;
                    rouletteClose.classList.remove('disabled');
                    return;
                }
                
                if (progress > 0.8) {
                    const diff = rouletteWinnerIndex - currentIndex;
                    if (Math.abs(diff) > 1) {
                        currentIndex += diff > 0 ? 1 : -1;
                    } else {
                        currentIndex = rouletteWinnerIndex;
                    }
                } else {
                    currentIndex = Math.floor(Math.random() * roulettePrizes.length);
                }
                
                highlightItem(currentIndex);
                
                const delay = progress > 0.8 ? 150 : 50;
                rouletteInterval = setTimeout(step, delay);
            }
            
            currentIndex = Math.floor(Math.random() * roulettePrizes.length);
            highlightItem(currentIndex);
            rouletteInterval = setTimeout(step, 50);
        }

        function generatePrize(type) {
            const rand = Math.random() * 100;
            
            switch(type) {
                case 'common':
                    if (rand < 0.5) return { type: 'stars', amount: 100, name: '100 ‚≠ê (–î–∂–µ–∫–ø–æ—Ç!)', icon: 'üíé' };
                    if (rand < 1) return { type: 'nft', name: 'NFT –û–±—ã—á–Ω—ã–π', icon: 'üé®' };
                    if (rand < 10) return { type: 'stars', amount: 50, name: '50 ‚≠ê', icon: '‚≠ê' };
                    if (rand < 25) return { type: 'stars', amount: 45, name: '45 ‚≠ê', icon: '‚≠ê' };
                    if (rand < 40) return { type: 'stars', amount: 40, name: '40 ‚≠ê', icon: '‚≠ê' };
                    if (rand < 55) return { type: 'stars', amount: 35, name: '35 ‚≠ê', icon: '‚≠ê' };
                    if (rand < 70) return { type: 'stars', amount: 30, name: '30 ‚≠ê', icon: '‚≠ê' };
                    if (rand < 85) return { type: 'stars', amount: 25, name: '25 ‚≠ê', icon: '‚≠ê' };
                    if (rand < 95) return { type: 'stars', amount: 20, name: '20 ‚≠ê', icon: '‚≠ê' };
                    return { type: 'stars', amount: 15, name: '15 ‚≠ê', icon: '‚≠ê' };
                    
                case 'rare':
                    if (rand < 0.3) return { type: 'stars', amount: 500, name: '500 ‚≠ê (–î–∂–µ–∫–ø–æ—Ç!)', icon: 'üëë' };
                    if (rand < 1) return { type: 'nft', name: 'NFT –†–µ–¥–∫–∏–π', icon: 'üé®' };
                    if (rand < 5) return { type: 'stars', amount: 250, name: '250 ‚≠ê', icon: '‚≠ê' };
                    if (rand < 15) return { type: 'stars', amount: 225, name: '225 ‚≠ê', icon: '‚≠ê' };
                    if (rand < 30) return { type: 'stars', amount: 200, name: '200 ‚≠ê', icon: '‚≠ê' };
                    if (rand < 45) return { type: 'stars', amount: 175, name: '175 ‚≠ê', icon: '‚≠ê' };
                    if (rand < 60) return { type: 'stars', amount: 150, name: '150 ‚≠ê', icon: '‚≠ê' };
                    if (rand < 75) return { type: 'stars', amount: 125, name: '125 ‚≠ê', icon: '‚≠ê' };
                    if (rand < 90) return { type: 'stars', amount: 100, name: '100 ‚≠ê', icon: '‚≠ê' };
                    return { type: 'stars', amount: 75, name: '75 ‚≠ê', icon: '‚≠ê' };
                    
                case 'epic':
                    if (rand < 0.2) return { type: 'ton', amount: 25, name: '25 TON (–î–∂–µ–∫–ø–æ—Ç!)', icon: 'üëë' };
                    if (rand < 1) return { type: 'nft', name: 'NFT –≠–ø–∏—á–µ—Å–∫–∏–π', icon: 'üé®' };
                    if (rand < 3) return { type: 'ton', amount: 10, name: '10 TON', icon: 'üíé' };
                    if (rand < 8) return { type: 'ton', amount: 8, name: '8 TON', icon: 'üíé' };
                    if (rand < 18) return { type: 'ton', amount: 7, name: '7 TON', icon: 'üíé' };
                    if (rand < 33) return { type: 'ton', amount: 6, name: '6 TON', icon: 'üíé' };
                    if (rand < 53) return { type: 'ton', amount: 5, name: '5 TON', icon: 'üíé' };
                    if (rand < 73) return { type: 'ton', amount: 4, name: '4 TON', icon: 'üíé' };
                    if (rand < 88) return { type: 'ton', amount: 3, name: '3 TON', icon: 'üíé' };
                    return { type: 'ton', amount: 2, name: '2 TON', icon: 'üíé' };
                    
                case 'legendary':
                    if (rand < 0.1) return { type: 'ton', amount: 100, name: '100 TON (–î–∂–µ–∫–ø–æ—Ç!)', icon: 'üíé' };
                    if (rand < 1) return { type: 'nft', name: 'NFT –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π', icon: 'üëë' };
                    if (rand < 3) return { type: 'ton', amount: 30, name: '30 TON', icon: 'üíé' };
                    if (rand < 8) return { type: 'ton', amount: 25, name: '25 TON', icon: 'üíé' };
                    if (rand < 18) return { type: 'ton', amount: 20, name: '20 TON', icon: 'üíé' };
                    if (rand < 33) return { type: 'ton', amount: 18, name: '18 TON', icon: 'üíé' };
                    if (rand < 48) return { type: 'ton', amount: 15, name: '15 TON', icon: 'üíé' };
                    if (rand < 63) return { type: 'ton', amount: 12, name: '12 TON', icon: 'üíé' };
                    if (rand < 78) return { type: 'ton', amount: 10, name: '10 TON', icon: 'üíé' };
                    return { type: 'ton', amount: 8, name: '8 TON', icon: 'üíé' };
            }
        }

        function showPrizeWinModal(prize) {
            const modal = document.getElementById('prizeWinModal');
            const iconEl = document.getElementById('prizeWinIcon');
            const nameEl = document.getElementById('prizeWinName');
            
            iconEl.innerHTML = prize.icon || 'üéâ';
            nameEl.innerHTML = `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${prize.name}!`;
            
            modal.classList.add('active');
        }

        function closePrizeWinModal() {
            document.getElementById('prizeWinModal').classList.remove('active');
        }

        window.openRoulette = openRoulette;
        window.closeRoulette = closeRoulette;
        window.spinRoulette = spinRoulette;
        window.closePrizeWinModal = closePrizeWinModal;
        window.closeWinModal = closeWinModal;
    </script>
</body>
</html>
