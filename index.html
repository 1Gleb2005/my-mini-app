<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CONTROL CENTER</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: #000000;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 8px;
        }

        .game-container {
            width: 100%;
            max-width: 380px;
            background: #000000;
            border-radius: 24px;
            padding: 16px;
            border: 2px solid #8a2be2;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.3);
        }

        /* CONTROL CENTER –∑–∞–≥–æ–ª–æ–≤–æ–∫ */
        .control-center-header {
            color: #8a2be2;
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px #8a2be2;
            border-bottom: 1px solid #8a2be2;
            padding-bottom: 10px;
        }

        /* –ß–µ—Ç—ã—Ä–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é */
        .menu-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .menu-btn {
            flex: 1;
            min-width: 70px;
            background: #000000;
            border: 2px solid #8a2be2;
            border-radius: 30px;
            padding: 12px 0;
            color: #8a2be2;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .menu-btn.active {
            background: #8a2be2;
            color: white;
            border-color: #8a2be2;
            box-shadow: 0 0 15px #8a2be2;
        }

        .menu-btn:active {
            transform: scale(0.96);
        }

        /* –ë–∞–ª–∞–Ω—Å */
        .balance-row {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 20px;
            background: #000000;
            border: 1px solid #8a2be2;
            border-radius: 50px;
            padding: 12px 16px;
        }

        .balance-item {
            padding: 5px 15px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 700;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(138, 43, 226, 0.1);
            border: 1px solid #8a2be2;
        }

        .currency-icon {
            font-size: 20px;
            color: #8a2be2;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–∞–∑–¥–µ–ª–æ–≤ */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* –ò–≥—Ä–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å */
        .game-area {
            background: #000000;
            border-radius: 20px;
            padding: 12px;
            margin-bottom: 12px;
            border: 2px solid #8a2be2;
            aspect-ratio: 1/1;
            position: relative;
            box-shadow: inset 0 0 20px rgba(138, 43, 226, 0.2);
        }

        #gameCanvas {
            width: 100%;
            height: 100%;
            display: block;
            border-radius: 12px;
            background: #000000;
        }

        .multiplier {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 42px;
            font-weight: 800;
            color: #ffffff;
            text-shadow: 0 0 20px #8a2be2;
            z-index: 10;
            background: rgba(0,0,0,0.7);
            padding: 8px 24px;
            border-radius: 40px;
            backdrop-filter: blur(4px);
            border: 1px solid #8a2be2;
        }

        /* –ò—Å—Ç–æ—Ä–∏—è */
        .history-container {
            background: #000000;
            border-radius: 16px;
            padding: 12px;
            margin-bottom: 16px;
            border: 1px solid #8a2be2;
        }

        .history-label {
            color: #8a2be2;
            font-size: 12px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        #history {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 4px;
            scrollbar-width: thin;
            scrollbar-color: #8a2be2 #000000;
        }

        #history::-webkit-scrollbar {
            height: 3px;
        }

        #history::-webkit-scrollbar-thumb {
            background: #8a2be2;
            border-radius: 3px;
        }

        .hist-item {
            background: #000000;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
            border: 1px solid #8a2be2;
            color: #8a2be2;
        }

        /* –°—Ç–∞–≤–∫–∞ */
        .bet-section {
            background: #000000;
            border-radius: 20px;
            padding: 16px;
            border: 1px solid #8a2be2;
        }

        .bet-input-row {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        #bet-input {
            flex: 1;
            background: #000000;
            border: 1px solid #8a2be2;
            border-radius: 30px;
            padding: 14px 16px;
            color: white;
            font-size: 18px;
            font-weight: 600;
            outline: none;
        }

        #bet-input:focus {
            border-color: #9b4dff;
            box-shadow: 0 0 10px #8a2be2;
        }

        .currency-selector {
            display: flex;
            background: #000000;
            border-radius: 30px;
            padding: 4px;
            border: 1px solid #8a2be2;
        }

        .curr-btn {
            background: none;
            border: none;
            color: #8a2be2;
            font-weight: 600;
            font-size: 14px;
            padding: 8px 16px;
            border-radius: 30px;
            transition: all 0.2s;
        }

        .curr-btn.active {
            background: #8a2be2;
            color: white;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .btn {
            flex: 1;
            border: none;
            border-radius: 40px;
            padding: 16px;
            font-size: 18px;
            font-weight: 700;
            transition: all 0.1s;
            cursor: pointer;
        }

        .btn:active {
            transform: scale(0.96);
        }

        .btn-primary {
            background: #8a2be2;
            color: white;
            border: 2px solid #8a2be2;
        }

        .btn-success {
            background: #8a2be2;
            color: white;
            border: 2px solid #8a2be2;
        }

        .hidden {
            display: none !important;
        }

        /* –ë—ã—Å—Ç—Ä—ã–µ —Å—Ç–∞–≤–∫–∏ */
        .quick-bets {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .quick-btn {
            flex: 1;
            background: #000000;
            border: 1px solid #8a2be2;
            border-radius: 20px;
            padding: 8px;
            color: #8a2be2;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
        }

        .quick-btn:active {
            background: #1a1a1a;
        }

        /* –ü—Ä–æ—Ñ–∏–ª—å */
        .profile-header {
            background: #000000;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            margin-bottom: 12px;
            border: 1px solid #8a2be2;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            background: #8a2be2;
            border-radius: 40px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
            border: 2px solid #8a2be2;
            box-shadow: 0 0 20px #8a2be2;
        }

        .profile-name {
            color: white;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .profile-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 16px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            color: white;
            font-size: 18px;
            font-weight: 700;
        }

        .stat-label {
            color: #8a2be2;
            font-size: 12px;
        }

        /* TON Connect —Å—Ç–∏–ª–∏ */
        .ton-connect-section {
            background: #000000;
            border-radius: 20px;
            padding: 20px;
            border: 2px solid #8a2be2;
            margin-bottom: 16px;
            text-align: center;
        }

        .ton-connect-title {
            color: #8a2be2;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .ton-connect-qr {
            width: 200px;
            height: 200px;
            background: #ffffff;
            margin: 0 auto 20px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            color: #000000;
            position: relative;
            overflow: hidden;
        }

        .ton-connect-text {
            color: #8a2be2;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .wallets-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .wallet-item {
            background: #000000;
            border: 2px solid #8a2be2;
            border-radius: 16px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .wallet-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(138, 43, 226, 0.3);
        }

        .wallet-item:active {
            transform: scale(0.95);
        }

        .wallet-icon {
            font-size: 32px;
            margin-bottom: 8px;
            color: #8a2be2;
        }

        .wallet-name {
            color: white;
            font-size: 14px;
            font-weight: 600;
        }

        .wallet-badge {
            background: #8a2be2;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-top: 5px;
            display: inline-block;
        }

        .ton-connect-button {
            background: #8a2be2;
            color: white;
            border: none;
            border-radius: 30px;
            padding: 16px;
            font-size: 18px;
            font-weight: 700;
            width: 100%;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ton-connect-button:active {
            transform: scale(0.96);
            box-shadow: 0 0 20px #8a2be2;
        }

        .view-all-wallets {
            color: #8a2be2;
            font-size: 14px;
            margin-top: 15px;
            cursor: pointer;
            text-decoration: underline;
        }

        /* Telegram Gift —Å—Ç–∏–ª–∏ */
        .gift-section {
            background: #000000;
            border-radius: 20px;
            padding: 20px;
            border: 2px solid #8a2be2;
            margin-bottom: 16px;
        }

        .gift-title {
            color: #8a2be2;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
        }

        .gift-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .gift-item {
            background: #000000;
            border: 1px solid #8a2be2;
            border-radius: 16px;
            padding: 15px 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .gift-item.locked {
            opacity: 0.5;
            filter: grayscale(1);
        }

        .gift-item.owned {
            border-color: #8a2be2;
            box-shadow: 0 0 15px #8a2be2;
        }

        .gift-item:active {
            transform: scale(0.95);
        }

        .gift-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .gift-name {
            color: white;
            font-size: 12px;
            font-weight: 600;
        }

        .gift-lock {
            position: absolute;
            top: 5px;
            right: 5px;
            color: #8a2be2;
            font-size: 14px;
        }

        .telegram-gift-button {
            background: #2AABEE;
            color: white;
            border: none;
            border-radius: 30px;
            padding: 16px;
            font-size: 18px;
            font-weight: 700;
            width: 100%;
            margin-top: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .telegram-gift-button:active {
            transform: scale(0.96);
            box-shadow: 0 0 20px #2AABEE;
        }

        /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 12px;
        }

        .inventory-item {
            background: #000000;
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            border: 1px solid #8a2be2;
        }

        .item-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .item-name {
            color: white;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .item-count {
            color: #8a2be2;
            font-size: 14px;
        }

        .item-rarity {
            font-size: 10px;
            padding: 4px 8px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 8px;
        }

        .rarity-common {
            background: #2a2a2a;
            color: #8a2be2;
            border: 1px solid #8a2be2;
        }

        .rarity-rare {
            background: #2a1a3a;
            color: #9b4dff;
            border: 1px solid #9b4dff;
        }

        .rarity-epic {
            background: #3a1a4a;
            color: #b86eff;
            border: 1px solid #b86eff;
        }

        .rarity-gift {
            background: #2AABEE;
            color: white;
            border: 1px solid #2AABEE;
        }

        /* –ö–µ–π—Å—ã */
        .cases-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 12px;
        }

        .case-item {
            background: #000000;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            border: 2px solid #8a2be2;
            cursor: pointer;
            transition: all 0.2s;
        }

        .case-item:active {
            transform: scale(0.96);
            box-shadow: 0 0 20px #8a2be2;
        }

        .case-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .case-name {
            color: white;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .case-price {
            color: #8a2be2;
            font-size: 16px;
            font-weight: 600;
        }

        /* –ö–Ω–æ–ø–∫–∞ —Ñ–∏–∫—Å–∞—Ü–∏–∏ —Å—Ç–∞–≤–∫–∏ */
        .fix-bet-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .fix-bet-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #8a2be2;
        }

        .fix-bet-label {
            color: #8a2be2;
            font-size: 14px;
        }

        /* Win –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä */
        .win-indicator {
            position: absolute;
            top: 80px;
            right: 20px;
            color: #8a2be2;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 0 0 10px #8a2be2;
            z-index: 10;
        }
    </style>
    
    <!-- TON Connect –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ -->
    <script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>
</head>
<body>
    <div class="game-container">
        <!-- CONTROL CENTER –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="control-center-header">CONTROL CENTER</div>

        <!-- –ë–∞–ª–∞–Ω—Å -->
        <div class="balance-row">
            <div class="balance-item">
                <span class="currency-icon">üíé</span>
                <span id="balance-ton">150</span>
            </div>
            <div class="balance-item">
                <span class="currency-icon">‚≠ê</span>
                <span id="balance-stars">2500</span>
            </div>
        </div>

        <!-- –ß–µ—Ç—ã—Ä–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é -->
        <div class="menu-buttons">
            <button class="menu-btn active" data-section="profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
            <button class="menu-btn" data-section="inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
            <button class="menu-btn" data-section="traffic">–†–∞–∫–µ—Ç–∞</button>
            <button class="menu-btn" data-section="cases">–ö–µ–π—Å—ã</button>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –ü—Ä–æ—Ñ–∏–ª—å -->
        <div id="profile-section" class="section active">
            <div class="profile-header">
                <div class="profile-avatar">üë§</div>
                <div class="profile-name">–ò–≥—Ä–æ–∫ #1234</div>
                <div class="profile-stats">
                    <div class="stat-item">
                        <div class="stat-value">127</div>
                        <div class="stat-label">–ò–≥—Ä</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">89</div>
                        <div class="stat-label">–ü–æ–±–µ–¥</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">2.4x</div>
                        <div class="stat-label">–°—Ä. –º–Ω–æ–∂–∏—Ç–µ–ª—å</div>
                    </div>
                </div>
            </div>

            <!-- TON Connect -->
            <div class="ton-connect-section">
                <div class="ton-connect-title">Connect your TON wallet</div>
                <div class="ton-connect-qr" id="tonQRCode">
                    üíé
                </div>
                <div class="ton-connect-text">Scan with your mobile wallet</div>
                
                <div class="wallets-grid">
                    <div class="wallet-item" onclick="connectWallet('telegram')">
                        <div class="wallet-icon">‚úàÔ∏è</div>
                        <div class="wallet-name">Wallet in Telegram</div>
                    </div>
                    <div class="wallet-item" onclick="connectWallet('tonkeeper')">
                        <div class="wallet-icon">üíé</div>
                        <div class="wallet-name">Tonkeeper</div>
                        <div class="wallet-badge">Popular</div>
                    </div>
                    <div class="wallet-item" onclick="connectWallet('mytonwallet')">
                        <div class="wallet-icon">üì±</div>
                        <div class="wallet-name">MyTonWallet</div>
                    </div>
                    <div class="wallet-item" onclick="connectWallet('all')">
                        <div class="wallet-icon">üîç</div>
                        <div class="wallet-name">View all wallets</div>
                    </div>
                </div>
                
                <button class="ton-connect-button" onclick="tonConnect()">
                    TON Connect
                </button>
                
                <div class="view-all-wallets" onclick="showAllWallets()">
                    View all wallets ‚Üí
                </div>
            </div>

            <!-- Telegram Gift —Ä–∞–∑–¥–µ–ª -->
            <div class="gift-section">
                <div class="gift-title">Telegram Gifts üéÅ</div>
                <div class="gift-grid" id="giftGrid">
                    <!-- –ü–æ–¥–∞—Ä–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Telegram API -->
                </div>
                
                <button class="telegram-gift-button" onclick="openGiftShop()">
                    üéÅ Open Gift Shop
                </button>
            </div>
            
            <div class="bet-section">
                <h3 style="color: #8a2be2; margin-bottom: 12px;">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
                <div style="background: #000000; border-radius: 12px; padding: 12px; margin-bottom: 8px; border: 1px solid #8a2be2;">
                    <div style="display: flex; justify-content: space-between; color: white;">
                        <span>üî• –ü–µ—Ä–≤—ã–π –≤—ã–∏–≥—Ä—ã—à</span>
                        <span style="color: #8a2be2;">‚úì</span>
                    </div>
                </div>
                <div style="background: #000000; border-radius: 12px; padding: 12px; margin-bottom: 8px; border: 1px solid #8a2be2;">
                    <div style="display: flex; justify-content: space-between; color: white;">
                        <span>‚ö° 10x –º–Ω–æ–∂–∏—Ç–µ–ª—å</span>
                        <span style="color: #8a2be2;">3/10</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
        <div id="inventory-section" class="section">
            <div class="inventory-grid" id="inventoryGrid">
                <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –†–∞–∫–µ—Ç–∞ (–ì—Ä–∞—Ñ–∏–∫) - –∏–≥—Ä–∞ -->
        <div id="traffic-section" class="section">
            <!-- –ò–≥—Ä–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å -->
            <div class="game-area" id="game-area">
                <div class="multiplier" id="multiplier">1.00x</div>
                <div class="win-indicator hidden" id="win-indicator">‚úì WIN</div>
                <canvas id="gameCanvas"></canvas>
            </div>

            <!-- –ò—Å—Ç–æ—Ä–∏—è -->
            <div class="history-container">
                <div class="history-label">–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä</div>
                <div id="history"></div>
            </div>

            <!-- –°—Ç–∞–≤–∫–∞ —Å –ø–æ–¥–∞—Ä–∫–∞–º–∏ -->
            <div class="bet-section">
                <div class="fix-bet-container">
                    <input type="checkbox" id="fix-bet" class="fix-bet-checkbox">
                    <label for="fix-bet" class="fix-bet-label">–§–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞–≤–∫—É</label>
                </div>

                <div class="bet-input-row">
                    <input type="number" id="bet-input" min="0.1" step="0.1" value="1.0">
                    <div class="currency-selector">
                        <button class="curr-btn active" data-curr="ton">TON</button>
                        <button class="curr-btn" data-curr="stars">STARS</button>
                        <button class="curr-btn" data-curr="gift">GIFT</button>
                    </div>
                </div>

                <!-- –í—ã–±–æ—Ä –ø–æ–¥–∞—Ä–∫–∞ –¥–ª—è —Å—Ç–∞–≤–∫–∏ -->
                <div id="giftSelector" style="display: none; margin-bottom: 12px;">
                    <select id="giftSelect" style="width: 100%; background: #000000; border: 1px solid #8a2be2; border-radius: 30px; padding: 12px; color: white; margin-bottom: 8px;">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫</option>
                    </select>
                </div>

                <!-- –ë—ã—Å—Ç—Ä—ã–µ —Å—Ç–∞–≤–∫–∏ -->
                <div class="quick-bets">
                    <button class="quick-btn" data-mult="2">2x</button>
                    <button class="quick-btn" data-mult="5">5x</button>
                    <button class="quick-btn" data-mult="10">10x</button>
                    <button class="quick-btn" data-mult="50">50x</button>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                <div class="action-buttons">
                    <button class="btn btn-primary" id="bet-btn">–ü–æ—Å—Ç–∞–≤–∏—Ç—å</button>
                    <button class="btn btn-success" id="cash-btn">–ó–∞–±—Ä–∞—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –ö–µ–π—Å—ã -->
        <div id="cases-section" class="section">
            <div class="cases-grid">
                <div class="case-item" onclick="openCase('common')">
                    <div class="case-icon">üì¶</div>
                    <div class="case-name">–û–±—ã—á–Ω—ã–π –∫–µ–π—Å</div>
                    <div class="case-price">50 Stars</div>
                </div>
                <div class="case-item" onclick="openCase('rare')">
                    <div class="case-icon">üéÅ</div>
                    <div class="case-name">–†–µ–¥–∫–∏–π –∫–µ–π—Å</div>
                    <div class="case-price">150 Stars</div>
                </div>
                <div class="case-item" onclick="openCase('epic')">
                    <div class="case-icon">üíé</div>
                    <div class="case-name">–≠–ø–∏—á–µ—Å–∫–∏–π –∫–µ–π—Å</div>
                    <div class="case-price">5 TON</div>
                </div>
                <div class="case-item" onclick="openCase('legendary')">
                    <div class="case-icon">üëë</div>
                    <div class="case-name">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π</div>
                    <div class="case-price">15 TON</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        let tg = window.Telegram?.WebApp;
        
        // TON Connect –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        let tonConnector = null;
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let isPlaying = false;
        let hasCashedOut = false;
        let gameLoop = null;
        let multiplier = 1.0;
        let rocket = { y: 0.5 };
        let crashPoint = 2.5;
        let canvas = document.getElementById('gameCanvas');
        let ctx = canvas.getContext('2d');
        let multEl = document.getElementById('multiplier');
        let winIndicator = document.getElementById('win-indicator');
        
        // –ë–∞–ª–∞–Ω—Å
        let balance = {
            ton: 150,
            stars: 2500
        };
        let currentCurr = 'ton';

        // –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å —Å –ø–æ–¥–∞—Ä–∫–∞–º–∏
        let inventory = {
            gifts: [] // –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏
        };

        // –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
        let availableGifts = [];

        // –¢—Ä–∞—Ñ–∏–∫ (–ª–∏–Ω–∏–∏)
        let trafficLines = [];
        const TRAFFIC_COUNT = 25;
        const TRAFFIC_SPEED = 0.04;

        // –§–∏–∫—Å–∞—Ü–∏—è —Å—Ç–∞–≤–∫–∏
        let fixBet = false;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function initTelegram() {
            if (tg) {
                tg.ready();
                tg.expand();
                
                // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                const user = tg.initDataUnsafe?.user;
                if (user) {
                    document.querySelector('.profile-name').innerText = user.first_name || '–ò–≥—Ä–æ–∫';
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–¥–∞—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                loadUserGifts();
            } else {
                // –ï—Å–ª–∏ –Ω–µ –≤ Telegram, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ-—Ä–µ–∂–∏–º
                console.log('Not in Telegram');
                loadDemoGifts();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ Telegram API
        function loadUserGifts() {
            if (tg) {
                // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –∫ –≤–∞—à–µ–º—É –±—ç–∫–µ–Ω–¥—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–∞—Ä–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º tg.sendData –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
                tg.sendData(JSON.stringify({
                    action: 'get_gifts'
                }));
                
                // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É
                availableGifts = [
                    { id: 'star', name: '–ó–≤–µ–∑–¥–∞', icon: 'üåü', price: 50, owned: true },
                    { id: 'crystal', name: '–ö—Ä–∏—Å—Ç–∞–ª–ª', icon: 'üíé', price: 100, owned: false },
                    { id: 'game', name: '–ò–≥—Ä–∞', icon: 'üéÆ', price: 150, owned: true },
                    { id: 'sticker', name: '–°—Ç–∏–∫–µ—Ä', icon: 'üé®', price: 30, owned: false },
                    { id: 'lightning', name: '–ú–æ–ª–Ω–∏—è', icon: '‚ö°', price: 200, owned: false },
                    { id: 'rainbow', name: '–†–∞–¥—É–≥–∞', icon: 'üåà', price: 75, owned: true }
                ];
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –∏–∑ owned –ø–æ–¥–∞—Ä–∫–æ–≤
                inventory.gifts = availableGifts.filter(g => g.owned);
                
                renderGifts();
                updateInventory();
            }
        }

        // –î–µ–º–æ-—Ä–µ–∂–∏–º –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
        function loadDemoGifts() {
            availableGifts = [
                { id: 'star', name: '–ó–≤–µ–∑–¥–∞', icon: 'üåü', price: 50, owned: true },
                { id: 'crystal', name: '–ö—Ä–∏—Å—Ç–∞–ª–ª', icon: 'üíé', price: 100, owned: false },
                { id: 'game', name: '–ò–≥—Ä–∞', icon: 'üéÆ', price: 150, owned: true },
                { id: 'sticker', name: '–°—Ç–∏–∫–µ—Ä', icon: 'üé®', price: 30, owned: false },
                { id: 'lightning', name: '–ú–æ–ª–Ω–∏—è', icon: '‚ö°', price: 200, owned: false },
                { id: 'rainbow', name: '–†–∞–¥—É–≥–∞', icon: 'üåà', price: 75, owned: true }
            ];
            
            inventory.gifts = availableGifts.filter(g => g.owned);
            renderGifts();
            updateInventory();
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤
        function renderGifts() {
            const giftGrid = document.getElementById('giftGrid');
            giftGrid.innerHTML = '';
            
            availableGifts.forEach(gift => {
                const giftElement = document.createElement('div');
                giftElement.className = `gift-item ${gift.owned ? 'owned' : 'locked'}`;
                giftElement.onclick = () => selectGift(gift);
                
                giftElement.innerHTML = `
                    <div class="gift-icon">${gift.icon}</div>
                    <div class="gift-name">${gift.name}</div>
                    <div class="gift-price">${gift.price} ‚≠ê</div>
                    ${!gift.owned ? '<div class="gift-lock">üîí</div>' : ''}
                `;
                
                giftGrid.appendChild(giftElement);
            });
        }

        // –í—ã–±–æ—Ä –ø–æ–¥–∞—Ä–∫–∞
        function selectGift(gift) {
            if (gift.owned) {
                if (tg) {
                    tg.showPopup({
                        title: gift.name,
                        message: `–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å ${gift.name}!`,
                        buttons: [{id: 'ok', type: 'ok', text: 'OK'}]
                    });
                } else {
                    alert(`–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å ${gift.name}!`);
                }
            } else {
                if (tg) {
                    tg.showPopup({
                        title: '–ö—É–ø–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫',
                        message: `–ö—É–ø–∏—Ç—å ${gift.name} –∑–∞ ${gift.price} Stars?`,
                        buttons: [
                            {id: 'buy', type: 'default', text: '–ö—É–ø–∏—Ç—å'},
                            {id: 'cancel', type: 'cancel', text: '–û—Ç–º–µ–Ω–∞'}
                        ]
                    }, (buttonId) => {
                        if (buttonId === 'buy') {
                            buyGift(gift);
                        }
                    });
                } else {
                    if (confirm(`–ö—É–ø–∏—Ç—å ${gift.name} –∑–∞ ${gift.price} Stars?`)) {
                        buyGift(gift);
                    }
                }
            }
        }

        // –ü–æ–∫—É–ø–∫–∞ –ø–æ–¥–∞—Ä–∫–∞
        function buyGift(gift) {
            if (balance.stars >= gift.price) {
                balance.stars -= gift.price;
                gift.owned = true;
                inventory.gifts.push(gift);
                
                if (tg) {
                    tg.sendData(JSON.stringify({
                        action: 'buy_gift',
                        gift_id: gift.id
                    }));
                    
                    tg.showPopup({
                        title: '–£—Å–ø–µ—à–Ω–æ!',
                        message: `–í—ã –∫—É–ø–∏–ª–∏ ${gift.name}!`,
                        buttons: [{id: 'ok', type: 'ok', text: 'OK'}]
                    });
                } else {
                    alert(`–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø–æ–ª—É—á–∏–ª–∏ ${gift.name}!`);
                }
                
                renderGifts();
                updateInventory();
                updateUI();
            } else {
                if (tg) {
                    tg.showPopup({
                        title: '–û—à–∏–±–∫–∞',
                        message: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Stars!',
                        buttons: [{id: 'ok', type: 'ok', text: 'OK'}]
                    });
                } else {
                    alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Stars!');
                }
            }
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞ –ø–æ–¥–∞—Ä–∫–æ–≤
        function openGiftShop() {
            if (tg) {
                tg.openLink('https://t.me/gift', { try_instant_view: false });
            } else {
                renderGifts();
            }
        }

        // TON Connect —Ñ—É–Ω–∫—Ü–∏–∏
        function initTONConnect() {
            try {
                tonConnector = new TONConnectSDK.TonConnect({
                    manifestUrl: 'https://your-domain.com/tonconnect-manifest.json'
                });
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR –∫–æ–¥
                const link = tonConnector.connect({
                    universalLink: 'https://app.tonkeeper.com/ton-connect',
                    bridgeUrl: 'https://bridge.tonapi.io/bridge'
                });
                
                document.getElementById('tonQRCode').innerHTML = 'üì±';
            } catch (e) {
                console.error('TON Connect error:', e);
            }
        }

        function connectWallet(wallet) {
            let walletInfo = {
                telegram: { name: 'Wallet in Telegram', link: 'tg://resolve?domain=wallet' },
                tonkeeper: { name: 'Tonkeeper', link: 'https://tonkeeper.com/' },
                mytonwallet: { name: 'MyTonWallet', link: 'https://mytonwallet.app/' },
                all: { name: 'All wallets', link: 'https://ton.org/wallets' }
            };
            
            if (wallet === 'all') {
                showAllWallets();
                return;
            }
            
            if (tg) {
                tg.openLink(walletInfo[wallet].link, { try_instant_view: false });
            } else {
                window.open(walletInfo[wallet].link, '_blank');
            }
        }

        function tonConnect() {
            if (tg && tonConnector) {
                tg.showPopup({
                    title: 'TON Connect',
                    message: 'Connect your TON wallet?',
                    buttons: [
                        {id: 'connect', type: 'default', text: 'Connect'},
                        {id: 'cancel', type: 'cancel', text: 'Cancel'}
                    ]
                }, (buttonId) => {
                    if (buttonId === 'connect') {
                        // –†–µ–∞–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ TON Connect
                        tonConnector.connect();
                    }
                });
            }
        }

        function showAllWallets() {
            const wallets = [
                'Tonkeeper',
                'Wallet in Telegram',
                'MyTonWallet',
                'Tonhub',
                'OpenMask',
                'TonFlow'
            ];
            
            if (tg) {
                tg.showPopup({
                    title: 'All Wallets',
                    message: wallets.join('\n'),
                    buttons: [{id: 'ok', type: 'ok', text: 'OK'}]
                });
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function updateInventory() {
            const inventoryGrid = document.getElementById('inventoryGrid');
            
            if (inventory.gifts.length === 0) {
                inventoryGrid.innerHTML = `
                    <div style="grid-column: span 2; text-align: center; padding: 40px; color: #8a2be2; border: 2px dashed #8a2be2; border-radius: 20px;">
                        <div style="font-size: 48px; margin-bottom: 10px;">üéÅ</div>
                        <div>–£ –≤–∞—Å –Ω–µ—Ç –ø–æ–¥–∞—Ä–∫–æ–≤</div>
                        <div style="font-size: 12px; margin-top: 10px;">–ö—É–ø–∏—Ç–µ –ø–æ–¥–∞—Ä–∫–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–µ</div>
                    </div>
                `;
                return;
            }
            
            inventoryGrid.innerHTML = '';
            
            // –ë–∞–∑–æ–≤—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
            const baseItems = [
                { icon: 'üöÄ', name: '–†–∞–∫–µ—Ç–∞', count: 3, rarity: 'common' },
                { icon: '‚ö°', name: '–£—Å–∫–æ—Ä–∏—Ç–µ–ª—å', count: 1, rarity: 'rare' },
                { icon: 'üõ°Ô∏è', name: '–©–∏—Ç', count: 2, rarity: 'common' },
                { icon: 'üíé', name: '–ö—Ä–∏—Å—Ç–∞–ª–ª', count: 5, rarity: 'epic' }
            ];
            
            baseItems.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'inventory-item';
                itemElement.innerHTML = `
                    <div class="item-icon">${item.icon}</div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-count">x${item.count}</div>
                    <div class="item-rarity rarity-${item.rarity}">${item.rarity}</div>
                `;
                inventoryGrid.appendChild(itemElement);
            });
            
            // –ü–æ–¥–∞—Ä–∫–∏ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ
            inventory.gifts.forEach(gift => {
                const giftElement = document.createElement('div');
                giftElement.className = 'inventory-item';
                giftElement.onclick = () => useGift(gift);
                giftElement.innerHTML = `
                    <div class="item-icon">${gift.icon}</div>
                    <div class="item-name">${gift.name}</div>
                    <div class="item-count">x1</div>
                    <div class="item-rarity rarity-gift">GIFT</div>
                `;
                inventoryGrid.appendChild(giftElement);
            });
        }

        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞
        function useGift(gift) {
            if (tg) {
                tg.showPopup({
                    title: gift.name,
                    message: `–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ${gift.name}?`,
                    buttons: [
                        {id: 'use', type: 'default', text: '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å'},
                        {id: 'cancel', type: 'cancel', text: '–û—Ç–º–µ–Ω–∞'}
                    ]
                }, (buttonId) => {
                    if (buttonId === 'use') {
                        // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –ø–æ–¥–∞—Ä–∫–∞
                        applyGiftEffect(gift);
                    }
                });
            } else {
                if (confirm(`–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ${gift.name}?`)) {
                    applyGiftEffect(gift);
                }
            }
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø–æ–¥–∞—Ä–∫–∞
        function applyGiftEffect(gift) {
            // –≠—Ñ—Ñ–µ–∫—Ç—ã –ø–æ–¥–∞—Ä–∫–æ–≤
            const effects = {
                'üåü': () => { balance.stars += 100; },
                'üíé': () => { balance.ton += 10; },
                'üéÆ': () => { multiplier += 0.5; },
                'üé®': () => { /* –≠—Ñ—Ñ–µ–∫—Ç —Å—Ç–∏–∫–µ—Ä–∞ */ },
                '‚ö°': () => { /* –£—Å–∫–æ—Ä–µ–Ω–∏–µ */ },
                'üåà': () => { /* –†–µ–¥–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç */ }
            };
            
            if (effects[gift.icon]) {
                effects[gift.icon]();
                // –£–¥–∞–ª—è–µ–º –ø–æ–¥–∞—Ä–æ–∫ –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                inventory.gifts = inventory.gifts.filter(g => g.id !== gift.id);
                availableGifts.find(g => g.id === gift.id).owned = false;
                
                updateInventory();
                renderGifts();
                updateUI();
                
                if (tg) {
                    tg.showPopup({
                        title: '–£—Å–ø–µ—à–Ω–æ!',
                        message: `–í—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ ${gift.name}!`,
                        buttons: [{id: 'ok', type: 'ok', text: 'OK'}]
                    });
                }
            }
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–∞
        function openCase(caseType) {
            const prices = {
                common: { stars: 50 },
                rare: { stars: 150 },
                epic: { ton: 5 },
                legendary: { ton: 15 }
            };
            
            let price = prices[caseType];
            let canOpen = false;
            
            if (price.stars && balance.stars >= price.stars) {
                balance.stars -= price.stars;
                canOpen = true;
            } else if (price.ton && balance.ton >= price.ton) {
                balance.ton -= price.ton;
                canOpen = true;
            }
            
            if (canOpen) {
                // –°–ª—É—á–∞–π–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫ –∏–∑ –∫–µ–π—Å–∞
                const randomGift = availableGifts[Math.floor(Math.random() * availableGifts.length)];
                randomGift.owned = true;
                inventory.gifts.push(randomGift);
                
                updateInventory();
                renderGifts();
                updateUI();
                
                if (tg) {
                    tg.showPopup({
                        title: '–ö–µ–π—Å –æ—Ç–∫—Ä—ã—Ç!',
                        message: `–í—ã –ø–æ–ª—É—á–∏–ª–∏ ${randomGift.name}!`,
                        buttons: [{id: 'ok', type: 'ok', text: 'OK'}]
                    });
                } else {
                    alert(`–í—ã –ø–æ–ª—É—á–∏–ª–∏ ${randomGift.name}!`);
                }
            } else {
                if (tg) {
                    tg.showPopup({
                        title: '–û—à–∏–±–∫–∞',
                        message: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!',
                        buttons: [{id: 'ok', type: 'ok', text: 'OK'}]
                    });
                } else {
                    alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!');
                }
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã
        document.querySelectorAll('.curr-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.curr-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentCurr = btn.dataset.curr;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –ø–æ–¥–∞—Ä–∫–∞
                const giftSelector = document.getElementById('giftSelector');
                if (currentCurr === 'gift') {
                    giftSelector.style.display = 'block';
                    updateGiftSelector();
                } else {
                    giftSelector.style.display = 'none';
                }
            });
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –ø–æ–¥–∞—Ä–∫–æ–≤
        function updateGiftSelector() {
            const select = document.getElementById('giftSelect');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫</option>';
            
            inventory.gifts.forEach((gift, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${gift.icon} ${gift.name}`;
                select.appendChild(option);
            });
        }

        // –û—Å—Ç–∞–ª—å–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π –∫–æ–¥ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        function initTraffic() {
            trafficLines = [];
            for (let i = 0; i < TRAFFIC_COUNT; i++) {
                trafficLines.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    speed: 0.3 + Math.random() * 2.5,
                    width: 1 + Math.random() * 4,
                    length: 20 + Math.random() * 50,
                    alpha: 0.2 + Math.random() * 0.7
                });
            }
        }

        function getRandomCrashPoint() {
            const r = Math.random();
            if (r < 0.4) return 1.2 + Math.random() * 1.5;
            if (r < 0.7) return 2.7 + Math.random() * 3;
            if (r < 0.9) return 5.7 + Math.random() * 6;
            return 11.7 + Math.random() * 20;
        }

        function placeBet() {
            if (isPlaying) return;
            
            let amt = parseFloat(document.getElementById('bet-input').value);
            if (isNaN(amt) || amt <= 0) return;
            
            if (currentCurr === 'gift') {
                const giftSelect = document.getElementById('giftSelect');
                const selectedIndex = giftSelect.value;
                
                if (selectedIndex === '') {
                    if (tg) {
                        tg.showPopup({
                            title: '–û—à–∏–±–∫–∞',
                            message: '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫ –¥–ª—è —Å—Ç–∞–≤–∫–∏',
                            buttons: [{id: 'ok', type: 'ok', text: 'OK'}]
                        });
                    } else {
                        alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫ –¥–ª—è —Å—Ç–∞–≤–∫–∏');
                    }
                    return;
                }
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–¥–∞—Ä–æ–∫ –∫–∞–∫ —Å—Ç–∞–≤–∫—É
                const gift = inventory.gifts[selectedIndex];
                inventory.gifts.splice(selectedIndex, 1);
                availableGifts.find(g => g.id === gift.id).owned = false;
                
                updateGiftSelector();
                updateInventory();
                renderGifts();
            } else {
                if (balance[currentCurr] < amt) {
                    if (tg) {
                        tg.showPopup({
                            title: '–û—à–∏–±–∫–∞',
                            message: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤',
                            buttons: [{id: 'ok', type: 'ok', text: 'OK'}]
                        });
                    } else {
                        alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
                    }
                    return;
                }
                
                balance[currentCurr] -= amt;
            }
            
            updateUI();
            
            // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∏–≥—Ä–µ
            isPlaying = true;
            hasCashedOut = false;
            multiplier = 1.0;
            crashPoint = getRandomCrashPoint();
            
            rocket.y = 0.5;
            
            initTraffic();
            
            document.getElementById('bet-btn').style.display = 'none';
            document.getElementById('cash-btn').style.display = 'block';
            winIndicator.classList.add('hidden');
            
            if (gameLoop) clearInterval(gameLoop);
            gameLoop = setInterval(update, 50);
        }

        function cashOut() {
            if (!isPlaying || hasCashedOut) return;
            
            const amt = parseFloat(document.getElementById('bet-input').value);
            const win = amt * multiplier;
            
            if (currentCurr === 'gift') {
                // –í—ã–∏–≥—Ä—ã—à –≤ –ø–æ–¥–∞—Ä–∫–∞—Ö
                // –ó–¥–µ—Å—å –ª–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–¥–∞—Ä–∫–∞
            } else {
                balance[currentCurr] += win;
            }
            
            updateUI();
            
            hasCashedOut = true;
            multEl.style.color = '#8a2be2';
            winIndicator.classList.remove('hidden');
            
            const hist = document.getElementById('history');
            const item = document.createElement('div');
            item.className = 'hist-item';
            item.style.color = '#8a2be2';
            item.style.fontWeight = 'bold';
            item.innerText = '‚úì ' + multiplier.toFixed(2) + 'x';
            hist.prepend(item);
            
            document.getElementById('cash-btn').style.display = 'none';
            document.getElementById('bet-btn').style.display = 'block';
            document.getElementById('bet-btn').disabled = true;
            document.getElementById('bet-btn').style.opacity = '0.5';
        }

        function finishGame(isWin) {
            clearInterval(gameLoop);
            isPlaying = false;
            
            document.getElementById('bet-btn').disabled = false;
            document.getElementById('bet-btn').style.opacity = '1';
            
            if (!isWin && !hasCashedOut) {
                multEl.style.color = '#ff4757';
                multEl.innerText = 'Crashed! ' + multiplier.toFixed(2) + 'x';
                
                const hist = document.getElementById('history');
                const item = document.createElement('div');
                item.className = 'hist-item';
                item.style.color = '#ff4757';
                item.innerText = 'üí• ' + multiplier.toFixed(2) + 'x';
                hist.prepend(item);
            } else if (!isWin && hasCashedOut) {
                multEl.style.color = '#8a2be2';
                multEl.innerText = 'Crashed @ ' + multiplier.toFixed(2) + 'x';
            }

            setTimeout(() => {
                document.getElementById('bet-btn').style.display = 'block';
                document.getElementById('cash-btn').style.display = 'none';
                multEl.style.color = '#ffffff';
                multEl.innerText = '1.00x';
                winIndicator.classList.add('hidden');
                rocket.y = 0.5;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                trafficLines = [];
                drawStartScreen();
                updateUI();
                
                if (fixBet) {
                    setTimeout(() => {
                        if (!isPlaying) {
                            placeBet();
                        }
                    }, 2100);
                }
            }, 2000);
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–æ–≤
        document.querySelectorAll('.menu-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                const section = btn.dataset.section;
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById(section + '-section').classList.add('active');
                
                if (section === 'traffic') {
                    setTimeout(() => {
                        resizeCanvas();
                        if (!isPlaying) {
                            drawStartScreen();
                        }
                    }, 50);
                } else if (section === 'inventory') {
                    updateInventory();
                }
            });
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –±–∞–ª–∞–Ω—Å–∞
        function updateUI() {
            document.getElementById('balance-ton').innerText = balance.ton;
            document.getElementById('balance-stars').innerText = balance.stars;
        }

        // –ë—ã—Å—Ç—Ä—ã–µ —Å—Ç–∞–≤–∫–∏
        document.querySelectorAll('.quick-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const mult = parseFloat(btn.dataset.mult);
                const currentBet = parseFloat(document.getElementById('bet-input').value);
                document.getElementById('bet-input').value = (currentBet * mult).toFixed(1);
            });
        });

        // –§–∏–∫—Å–∞—Ü–∏—è —Å—Ç–∞–≤–∫–∏
        document.getElementById('fix-bet').addEventListener('change', (e) => {
            fixBet = e.target.checked;
        });

        // –§—É–Ω–∫—Ü–∏–∏ —Ä–∏—Å–æ–≤–∞–Ω–∏—è
        function drawStartScreen() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = 'rgba(138, 43, 226, 0.2)';
            for (let i = 0; i < 40; i++) {
                ctx.beginPath();
                ctx.arc(
                    Math.random() * canvas.width, 
                    Math.random() * canvas.height, 
                    1 + Math.random() * 2, 
                    0, Math.PI * 2
                );
                ctx.fill();
            }
            
            ctx.save();
            ctx.translate(canvas.width / 2, canvas.height - 50);
            ctx.fillStyle = '#8a2be2';
            ctx.shadowColor = '#8a2be2';
            ctx.shadowBlur = 15;
            
            ctx.beginPath();
            ctx.moveTo(0, -25);
            ctx.lineTo(12, 0);
            ctx.lineTo(4, 0);
            ctx.lineTo(4, 15);
            ctx.lineTo(-4, 15);
            ctx.lineTo(-4, 0);
            ctx.lineTo(-12, 0);
            ctx.closePath();
            ctx.fill();
            
            ctx.shadowBlur = 10;
            ctx.fillStyle = '#ffaa33';
            ctx.beginPath();
            ctx.moveTo(-4, 15);
            ctx.lineTo(0, 25);
            ctx.lineTo(4, 15);
            ctx.fill();
            ctx.restore();
            
            ctx.font = 'bold 14px system-ui, -apple-system, sans-serif';
            ctx.fillStyle = '#8a2be2';
            ctx.shadowBlur = 0;
            ctx.fillText('–°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É', canvas.width/2 - 70, canvas.height/2);
        }

        function drawGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = 'rgba(138, 43, 226, 0.1)';
            for (let i = 0; i < 30; i++) {
                ctx.beginPath();
                ctx.arc(
                    15 + (i * 23) % canvas.width, 
                    25 + (i * 17) % canvas.height, 
                    1 + i % 2, 
                    0, Math.PI * 2
                );
                ctx.fill();
            }
            
            if (trafficLines.length > 0) {
                drawTraffic();
            }
            
            ctx.save();
            ctx.strokeStyle = 'rgba(138, 43, 226, 0.15)';
            ctx.lineWidth = 1.5;
            ctx.setLineDash([8, 12]);
            ctx.beginPath();
            ctx.moveTo(canvas.width * 0.15, canvas.height - 20);
            ctx.lineTo(canvas.width * 0.85, 20);
            ctx.stroke();
            ctx.restore();
            
            ctx.save();
            const rocketX = canvas.width * 0.15 + (canvas.width * 0.7) * Math.min(multiplier / 12, 1);
            const rocketY = canvas.height - 20 - (canvas.height - 40) * Math.min(multiplier / 18, 1);
            
            ctx.translate(rocketX, rocketY);
            
            const angle = Math.atan2(-30, canvas.width * 0.7 / 12);
            ctx.rotate(angle * 0.5);
            
            ctx.shadowColor = '#8a2be2';
            ctx.shadowBlur = 20;
            
            ctx.fillStyle = '#8a2be2';
            ctx.beginPath();
            ctx.moveTo(0, -15);
            ctx.lineTo(10, 0);
            ctx.lineTo(3, 0);
            ctx.lineTo(3, 10);
            ctx.lineTo(-3, 10);
            ctx.lineTo(-3, 0);
            ctx.lineTo(-10, 0);
            ctx.closePath();
            ctx.fill();
            
            ctx.shadowColor = '#ffaa33';
            ctx.fillStyle = '#ffaa33';
            ctx.beginPath();
            ctx.moveTo(-3, 10);
            ctx.lineTo(0, 18);
            ctx.lineTo(3, 10);
            ctx.fill();
            
            ctx.restore();
        }

        function update() {
            if (!isPlaying) return;
            
            multiplier += 0.015;
            multEl.innerText = multiplier.toFixed(2) + 'x';
            
            rocket.y -= config.lift * 0.5;
            if (rocket.y < 0.1) rocket.y = 0.1;
            
            updateTraffic();
            drawGame();
            
            if (!hasCashedOut && multiplier >= crashPoint) {
                finishGame(false);
            }
        }

        function updateTraffic() {
            for (let i = 0; i < trafficLines.length; i++) {
                const line = trafficLines[i];
                line.y -= line.speed * TRAFFIC_SPEED * canvas.height * (0.5 + multiplier * 0.5);
                
                if (line.y < -line.length) {
                    line.y = canvas.height + Math.random() * 50;
                    line.x = Math.random() * canvas.width;
                    line.speed = 0.3 + Math.random() * 2.5;
                }
            }
        }

        function drawTraffic() {
            ctx.save();
            
            for (let i = 0; i < trafficLines.length; i++) {
                const line = trafficLines[i];
                
                ctx.strokeStyle = `rgba(138, 43, 226, ${line.alpha})`;
                ctx.lineWidth = line.width;
                ctx.lineCap = 'round';
                
                ctx.beginPath();
                ctx.moveTo(line.x, line.y);
                ctx.lineTo(line.x + 20, line.y - 20);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(line.x - 8, line.y + 5);
                ctx.lineTo(line.x + 12, line.y - 15);
                ctx.stroke();
                
                if (i % 2 === 0) {
                    ctx.fillStyle = `rgba(138, 43, 226, ${line.alpha * 0.8})`;
                    ctx.beginPath();
                    ctx.arc(line.x + 10, line.y - 10, line.width * 0.8, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            ctx.restore();
        }

        // –ê–≤—Ç–æ-–ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ canvas
        function resizeCanvas() {
            const rect = document.getElementById('game-area').getBoundingClientRect();
            if (rect.width > 0 && rect.height > 0) {
                canvas.width = rect.width;
                canvas.height = rect.height;
                
                if (!isPlaying) {
                    drawStartScreen();
                } else {
                    drawGame();
                }
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('resize', () => {
            setTimeout(resizeCanvas, 50);
        });
        
        setTimeout(() => {
            resizeCanvas();
            initTraffic();
            updateUI();
            drawStartScreen();
            initTelegram();
            initTONConnect();
        }, 100);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('bet-btn').addEventListener('click', placeBet);
        document.getElementById('cash-btn').addEventListener('click', cashOut);
    </script>
</body>
</html>
